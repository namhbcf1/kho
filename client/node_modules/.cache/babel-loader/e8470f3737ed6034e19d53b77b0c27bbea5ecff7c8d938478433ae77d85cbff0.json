{"ast":null,"code":"import React,{useEffect,useRef,useState,useCallback}from'react';import{Modal,Button,Space,message,Alert,Typography,Divider}from'antd';import{CameraOutlined,CloseOutlined,ReloadOutlined,ExclamationCircleOutlined,CheckCircleOutlined}from'@ant-design/icons';import{Html5QrcodeScanner}from'html5-qrcode';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Text}=Typography;// Define supported formats manually to avoid import issues\nconst SUPPORTED_FORMATS={QR_CODE:0,AZTEC:1,CODABAR:2,CODE_39:3,CODE_93:4,CODE_128:5,DATA_MATRIX:6,MAXICODE:7,ITF:8,EAN_13:9,EAN_8:10,PDF_417:11,RSS_14:12,RSS_EXPANDED:13,UPC_A:14,UPC_E:15,UPC_EAN_EXTENSION:16};const QRScanner=_ref=>{let{visible,onClose,onScan,title=\"Quét Serial Number\",placeholder=\"Đưa camera vào mã QR hoặc Barcode\"}=_ref;const scannerContainerRef=useRef(null);const[isScanning,setIsScanning]=useState(false);const[error,setError]=useState(null);const[scannerInstance,setScannerInstance]=useState(null);const[permissionState,setPermissionState]=useState('unknown');// 'granted', 'denied', 'prompt', 'unknown'\nconst[cameraDevices,setCameraDevices]=useState([]);const[selectedCameraId,setSelectedCameraId]=useState(null);const[isClosing,setIsClosing]=useState(false);// 🔧 FIXED: Proper cleanup with useCallback to prevent memory leaks\nconst stopScanner=useCallback(async()=>{try{if(scannerInstance){// Only clear if container still exists in DOM\nconst container=scannerContainerRef.current;if(container&&container.childNodes.length>0){await scannerInstance.clear();}setScannerInstance(null);}setIsScanning(false);}catch(err){console.error('Error stopping scanner:',err);// Even if clear fails, reset the instance to prevent further errors\nsetScannerInstance(null);setIsScanning(false);}},[scannerInstance]);// 🔧 FIXED: Enhanced useEffect with proper cleanup\nuseEffect(()=>{let mounted=true;if(visible&&!isClosing){console.log('🚀 QR Scanner opening...');checkCameraPermission();}else if(!visible&&scannerInstance){console.log('🔄 QR Scanner closing...');stopScanner();}// 🔧 FIXED: Cleanup on unmount\nreturn()=>{mounted=false;if(scannerInstance){console.log('🧹 Cleaning up QR scanner on unmount...');stopScanner();}};},[visible,isClosing,scannerInstance,stopScanner]);// 🔧 FIXED: Check camera permission with better error handling\nconst checkCameraPermission=async()=>{try{// Check if getUserMedia is available\nif(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){setError('Trình duyệt không hỗ trợ truy cập camera. Vui lòng sử dụng trình duyệt hiện đại.');return;}// Check permission API if available\nif(navigator.permissions){try{const permission=await navigator.permissions.query({name:'camera'});setPermissionState(permission.state);permission.onchange=()=>{setPermissionState(permission.state);};}catch(err){console.log('Permission API not fully supported');}}// Get camera devices\nawait getCameraDevices();// Try to start scanner\nawait startScanner();}catch(err){console.error('Camera permission check failed:',err);handleCameraError(err);}};// Get available camera devices\nconst getCameraDevices=async()=>{try{const devices=await navigator.mediaDevices.enumerateDevices();const videoDevices=devices.filter(device=>device.kind==='videoinput');setCameraDevices(videoDevices);// Prefer back camera on mobile\nconst backCamera=videoDevices.find(device=>device.label.toLowerCase().includes('back')||device.label.toLowerCase().includes('rear')||device.label.toLowerCase().includes('environment'));if(backCamera){setSelectedCameraId(backCamera.deviceId);}else if(videoDevices.length>0){setSelectedCameraId(videoDevices[0].deviceId);}}catch(err){console.error('Error getting camera devices:',err);}};// Request camera permission explicitly\nconst requestCameraPermission=async()=>{try{setError(null);const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'// Prefer back camera\n}});// Stop the stream immediately as we just needed permission\nstream.getTracks().forEach(track=>track.stop());setPermissionState('granted');message.success('✅ Đã cấp quyền truy cập camera!');// Now start the scanner\nawait startScanner();}catch(err){console.error('Camera permission denied:',err);setPermissionState('denied');handleCameraError(err);}};const handleCameraError=err=>{if(err.name==='NotAllowedError'||err.name==='PermissionDeniedError'){setError('Quyền truy cập camera bị từ chối. Vui lòng cho phép truy cập camera trong cài đặt trình duyệt.');setPermissionState('denied');}else if(err.name==='NotFoundError'||err.name==='DevicesNotFoundError'){setError('Không tìm thấy camera. Vui lòng kiểm tra kết nối camera.');}else if(err.name==='NotSupportedError'){setError('Trình duyệt không hỗ trợ truy cập camera.');}else if(err.name==='NotReadableError'){setError('Camera đang được sử dụng bởi ứng dụng khác.');}else{setError(\"L\\u1ED7i camera: \".concat(err.message||'Không thể truy cập camera'));}};// 🔧 FIXED: Enhanced startScanner with better error handling and DOM checks\nconst startScanner=async()=>{try{setError(null);setIsScanning(true);// 🔧 FIXED: Clear any existing scanner first\nif(scannerInstance){await stopScanner();// Wait a bit for cleanup to complete\nawait new Promise(resolve=>setTimeout(resolve,100));}// 🔧 FIXED: Check if DOM element exists before creating scanner\nconst container=scannerContainerRef.current;if(!container){console.error('QR reader element not found');setError('Không thể khởi tạo scanner. Vui lòng thử lại.');setIsScanning(false);return;}// Enhanced configuration for better mobile support\nconst config={fps:10,qrbox:function(viewfinderWidth,viewfinderHeight){// Make qrbox responsive\nconst minEdgePercentage=0.7;const minEdgeSize=Math.min(viewfinderWidth,viewfinderHeight);const qrboxSize=Math.floor(minEdgeSize*minEdgePercentage);return{width:qrboxSize,height:qrboxSize};},aspectRatio:1.0,disableFlip:false,// Camera constraints for mobile\nvideoConstraints:{facingMode:'environment',// Use back camera\nadvanced:[{focusMode:'continuous'},{exposureMode:'continuous'},{whiteBalanceMode:'continuous'}]},// Support multiple formats using our constants\nformatsToSupport:[SUPPORTED_FORMATS.QR_CODE,SUPPORTED_FORMATS.CODE_128,SUPPORTED_FORMATS.CODE_39,SUPPORTED_FORMATS.CODE_93,SUPPORTED_FORMATS.EAN_13,SUPPORTED_FORMATS.EAN_8,SUPPORTED_FORMATS.UPC_A,SUPPORTED_FORMATS.UPC_E]};console.log('🔧 Creating new QR scanner instance...');const scanner=new Html5QrcodeScanner(container,config,false// verbose logging\n);scanner.render((decodedText,decodedResult)=>{// Success callback\nconsole.log('✅ QR Code scanned successfully:',decodedText);message.success(\"\\uD83D\\uDCF1 \\u0110\\xE3 qu\\xE9t th\\xE0nh c\\xF4ng: \".concat(decodedText));onScan(decodedText);handleClose();},error=>{// Error callback - only log, don't show to user\nif(error&&!error.includes('NotFoundException')){console.warn(\"QR scan error: \".concat(error));}});setScannerInstance(scanner);setPermissionState('granted');console.log('✅ QR scanner started successfully');}catch(err){console.error('Scanner initialization error:',err);handleCameraError(err);setIsScanning(false);}};// 🔧 FIXED: Enhanced handleClose with proper cleanup sequence\nconst handleClose=async()=>{console.log('🔄 Closing QR scanner...');setIsClosing(true);try{// Stop scanner first\nawait stopScanner();// Reset states\nsetError(null);setPermissionState('unknown');setIsClosing(false);// Close modal\nonClose();console.log('✅ QR scanner closed successfully');}catch(err){console.error('Error during close:',err);setIsClosing(false);onClose();}};const handleRestart=async()=>{console.log('🔄 Restarting QR scanner...');setError(null);await stopScanner();// Wait a bit before restarting\nsetTimeout(()=>{checkCameraPermission();},500);};// Render permission request UI\nconst renderPermissionRequest=()=>/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',padding:'40px 20px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'64px',marginBottom:'20px'},children:\"\\uD83D\\uDCF1\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'18px',fontWeight:'bold',marginBottom:'12px'},children:\"C\\u1EA7n quy\\u1EC1n truy c\\u1EADp Camera\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'14px',color:'#666',marginBottom:'24px',lineHeight:'1.5'},children:[\"\\u0110\\u1EC3 qu\\xE9t m\\xE3 QR/Barcode, \\u1EE9ng d\\u1EE5ng c\\u1EA7n quy\\u1EC1n truy c\\u1EADp camera c\\u1EE7a thi\\u1EBFt b\\u1ECB.\",/*#__PURE__*/_jsx(\"br\",{}),\"Vui l\\xF2ng b\\u1EA5m \\\"Cho ph\\xE9p\\\" khi tr\\xECnh duy\\u1EC7t h\\u1ECFi.\"]}),/*#__PURE__*/_jsx(Button,{type:\"primary\",size:\"large\",icon:/*#__PURE__*/_jsx(CameraOutlined,{}),onClick:requestCameraPermission,style:{background:'#52c41a',borderColor:'#52c41a',height:'48px',fontSize:'16px',fontWeight:'bold'},children:\"\\uD83D\\uDD13 C\\u1EA5p quy\\u1EC1n Camera\"}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#999',textAlign:'left'},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'8px',fontWeight:'bold'},children:\"\\uD83D\\uDCA1 L\\u01B0u \\xFD:\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Tr\\xEAn \",/*#__PURE__*/_jsx(\"strong\",{children:\"iPhone/iPad\"}),\": B\\u1EA5m \\\"Cho ph\\xE9p\\\" khi Safari h\\u1ECFi\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Tr\\xEAn \",/*#__PURE__*/_jsx(\"strong\",{children:\"Android\"}),\": B\\u1EA5m \\\"Allow\\\" khi Chrome h\\u1ECFi\"]}),/*#__PURE__*/_jsx(\"div\",{children:\"\\u2022 N\\u1EBFu \\u0111\\xE3 t\\u1EEB ch\\u1ED1i: V\\xE0o Settings \\u2192 Camera \\u2192 Cho ph\\xE9p trang web n\\xE0y\"})]})]});return/*#__PURE__*/_jsx(Modal,{title:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(CameraOutlined,{style:{color:'#1890ff'}}),/*#__PURE__*/_jsx(\"span\",{children:title}),permissionState==='granted'&&/*#__PURE__*/_jsx(CheckCircleOutlined,{style:{color:'#52c41a',marginLeft:'8px'}})]}),open:visible,onCancel:handleClose,width:Math.min(600,window.innerWidth-32),footer:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleRestart,icon:/*#__PURE__*/_jsx(ReloadOutlined,{}),disabled:isClosing,children:\"Th\\u1EED l\\u1EA1i\"}),/*#__PURE__*/_jsx(Button,{onClick:handleClose,icon:/*#__PURE__*/_jsx(CloseOutlined,{}),disabled:isClosing,children:\"\\u0110\\xF3ng\"})]})// 🔧 FIXED: Removed destroyOnClose to prevent DOM removal conflicts\n,centered:true,style:{top:20},confirmLoading:isClosing,children:/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',padding:'20px 0'},children:[(permissionState==='denied'||permissionState==='prompt'||permissionState==='unknown')&&!scannerInstance&&renderPermissionRequest(),error&&/*#__PURE__*/_jsx(Alert,{message:\"L\\u1ED7i Camera\",description:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:error}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'12px',fontSize:'12px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"C\\xE1ch kh\\u1EAFc ph\\u1EE5c:\"}),/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 \\u0110\\u1EA3m b\\u1EA3o trang web \\u0111\\u01B0\\u1EE3c truy c\\u1EADp qua HTTPS\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Ki\\u1EC3m tra c\\xE0i \\u0111\\u1EB7t quy\\u1EC1n camera trong tr\\xECnh duy\\u1EC7t\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Th\\u1EED t\\u1EA3i l\\u1EA1i trang v\\xE0 c\\u1EA5p quy\\u1EC1n l\\u1EA1i\"]})]}),type:\"error\",showIcon:true,style:{marginBottom:16,textAlign:'left'},action:/*#__PURE__*/_jsx(Button,{size:\"small\",onClick:requestCameraPermission,children:\"Th\\u1EED l\\u1EA1i\"})}),permissionState==='granted'&&!error&&/*#__PURE__*/_jsx(Alert,{message:\"Camera \\u0111\\xE3 s\\u1EB5n s\\xE0ng\",description:placeholder,type:\"success\",showIcon:true,style:{marginBottom:16}}),permissionState==='granted'&&!error&&/*#__PURE__*/_jsx(\"div\",{ref:scannerContainerRef,style:{width:'100%',maxWidth:'500px',margin:'0 auto',border:'2px dashed #52c41a',borderRadius:'8px',minHeight:'300px',display:'flex',alignItems:'center',justifyContent:'center'},children:!scannerInstance&&/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',color:'#999'},children:[/*#__PURE__*/_jsx(CameraOutlined,{style:{fontSize:'48px',marginBottom:'16px'}}),/*#__PURE__*/_jsx(\"div\",{children:\"\\u0110ang kh\\u1EDFi t\\u1EA1o camera...\"})]})}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:16,fontSize:'12px',color:'#666'},children:/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"\\uD83D\\uDCA1 H\\u1ED7 tr\\u1EE3 qu\\xE9t: QR Code, Code 128, Code 39, EAN-13, UPC-A v\\xE0 nhi\\u1EC1u \\u0111\\u1ECBnh d\\u1EA1ng kh\\xE1c\"})})]})});};export default QRScanner;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","Modal","Button","Space","message","Alert","Typography","Divider","CameraOutlined","CloseOutlined","ReloadOutlined","ExclamationCircleOutlined","CheckCircleOutlined","Html5QrcodeScanner","jsx","_jsx","jsxs","_jsxs","Text","SUPPORTED_FORMATS","QR_CODE","AZTEC","CODABAR","CODE_39","CODE_93","CODE_128","DATA_MATRIX","MAXICODE","ITF","EAN_13","EAN_8","PDF_417","RSS_14","RSS_EXPANDED","UPC_A","UPC_E","UPC_EAN_EXTENSION","QRScanner","_ref","visible","onClose","onScan","title","placeholder","scannerContainerRef","isScanning","setIsScanning","error","setError","scannerInstance","setScannerInstance","permissionState","setPermissionState","cameraDevices","setCameraDevices","selectedCameraId","setSelectedCameraId","isClosing","setIsClosing","stopScanner","container","current","childNodes","length","clear","err","console","mounted","log","checkCameraPermission","navigator","mediaDevices","getUserMedia","permissions","permission","query","name","state","onchange","getCameraDevices","startScanner","handleCameraError","devices","enumerateDevices","videoDevices","filter","device","kind","backCamera","find","label","toLowerCase","includes","deviceId","requestCameraPermission","stream","video","facingMode","getTracks","forEach","track","stop","success","concat","Promise","resolve","setTimeout","config","fps","qrbox","viewfinderWidth","viewfinderHeight","minEdgePercentage","minEdgeSize","Math","min","qrboxSize","floor","width","height","aspectRatio","disableFlip","videoConstraints","advanced","focusMode","exposureMode","whiteBalanceMode","formatsToSupport","scanner","render","decodedText","decodedResult","handleClose","warn","handleRestart","renderPermissionRequest","style","textAlign","padding","children","fontSize","marginBottom","fontWeight","color","lineHeight","type","size","icon","onClick","background","borderColor","display","alignItems","gap","marginLeft","open","onCancel","window","innerWidth","footer","disabled","centered","top","confirmLoading","description","marginTop","showIcon","action","ref","maxWidth","margin","border","borderRadius","minHeight","justifyContent"],"sources":["C:/Users/ADMIN/Desktop/kho/kho/client/src/components/QRScanner.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { Modal, Button, Space, message, Alert, Typography, Divider } from 'antd';\r\nimport { CameraOutlined, CloseOutlined, ReloadOutlined, ExclamationCircleOutlined, CheckCircleOutlined } from '@ant-design/icons';\r\nimport { Html5QrcodeScanner } from 'html5-qrcode';\r\n\r\nconst { Text } = Typography;\r\n\r\n// Define supported formats manually to avoid import issues\r\nconst SUPPORTED_FORMATS = {\r\n  QR_CODE: 0,\r\n  AZTEC: 1,\r\n  CODABAR: 2,\r\n  CODE_39: 3,\r\n  CODE_93: 4,\r\n  CODE_128: 5,\r\n  DATA_MATRIX: 6,\r\n  MAXICODE: 7,\r\n  ITF: 8,\r\n  EAN_13: 9,\r\n  EAN_8: 10,\r\n  PDF_417: 11,\r\n  RSS_14: 12,\r\n  RSS_EXPANDED: 13,\r\n  UPC_A: 14,\r\n  UPC_E: 15,\r\n  UPC_EAN_EXTENSION: 16\r\n};\r\n\r\nconst QRScanner = ({ \r\n  visible, \r\n  onClose, \r\n  onScan, \r\n  title = \"Quét Serial Number\",\r\n  placeholder = \"Đưa camera vào mã QR hoặc Barcode\" \r\n}) => {\r\n  const scannerContainerRef = useRef(null);\r\n  const [isScanning, setIsScanning] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [scannerInstance, setScannerInstance] = useState(null);\r\n  const [permissionState, setPermissionState] = useState('unknown'); // 'granted', 'denied', 'prompt', 'unknown'\r\n  const [cameraDevices, setCameraDevices] = useState([]);\r\n  const [selectedCameraId, setSelectedCameraId] = useState(null);\r\n  const [isClosing, setIsClosing] = useState(false);\r\n\r\n  // 🔧 FIXED: Proper cleanup with useCallback to prevent memory leaks\r\n  const stopScanner = useCallback(async () => {\r\n    try {\r\n      if (scannerInstance) {\r\n        // Only clear if container still exists in DOM\r\n        const container = scannerContainerRef.current;\r\n        if (container && container.childNodes.length > 0) {\r\n          await scannerInstance.clear();\r\n        }\r\n        setScannerInstance(null);\r\n      }\r\n      setIsScanning(false);\r\n    } catch (err) {\r\n      console.error('Error stopping scanner:', err);\r\n      // Even if clear fails, reset the instance to prevent further errors\r\n      setScannerInstance(null);\r\n      setIsScanning(false);\r\n    }\r\n  }, [scannerInstance]);\r\n\r\n  // 🔧 FIXED: Enhanced useEffect with proper cleanup\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    if (visible && !isClosing) {\r\n      console.log('🚀 QR Scanner opening...');\r\n      checkCameraPermission();\r\n    } else if (!visible && scannerInstance) {\r\n      console.log('🔄 QR Scanner closing...');\r\n      stopScanner();\r\n    }\r\n\r\n    // 🔧 FIXED: Cleanup on unmount\r\n    return () => {\r\n      mounted = false;\r\n      if (scannerInstance) {\r\n        console.log('🧹 Cleaning up QR scanner on unmount...');\r\n        stopScanner();\r\n      }\r\n    };\r\n  }, [visible, isClosing, scannerInstance, stopScanner]);\r\n\r\n  // 🔧 FIXED: Check camera permission with better error handling\r\n  const checkCameraPermission = async () => {\r\n    try {\r\n      // Check if getUserMedia is available\r\n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n        setError('Trình duyệt không hỗ trợ truy cập camera. Vui lòng sử dụng trình duyệt hiện đại.');\r\n        return;\r\n      }\r\n\r\n      // Check permission API if available\r\n      if (navigator.permissions) {\r\n        try {\r\n          const permission = await navigator.permissions.query({ name: 'camera' });\r\n          setPermissionState(permission.state);\r\n          \r\n          permission.onchange = () => {\r\n            setPermissionState(permission.state);\r\n          };\r\n        } catch (err) {\r\n          console.log('Permission API not fully supported');\r\n        }\r\n      }\r\n\r\n      // Get camera devices\r\n      await getCameraDevices();\r\n      \r\n      // Try to start scanner\r\n      await startScanner();\r\n      \r\n    } catch (err) {\r\n      console.error('Camera permission check failed:', err);\r\n      handleCameraError(err);\r\n    }\r\n  };\r\n\r\n  // Get available camera devices\r\n  const getCameraDevices = async () => {\r\n    try {\r\n      const devices = await navigator.mediaDevices.enumerateDevices();\r\n      const videoDevices = devices.filter(device => device.kind === 'videoinput');\r\n      setCameraDevices(videoDevices);\r\n      \r\n      // Prefer back camera on mobile\r\n      const backCamera = videoDevices.find(device => \r\n        device.label.toLowerCase().includes('back') || \r\n        device.label.toLowerCase().includes('rear') ||\r\n        device.label.toLowerCase().includes('environment')\r\n      );\r\n      \r\n      if (backCamera) {\r\n        setSelectedCameraId(backCamera.deviceId);\r\n      } else if (videoDevices.length > 0) {\r\n        setSelectedCameraId(videoDevices[0].deviceId);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error getting camera devices:', err);\r\n    }\r\n  };\r\n\r\n  // Request camera permission explicitly\r\n  const requestCameraPermission = async () => {\r\n    try {\r\n      setError(null);\r\n      const stream = await navigator.mediaDevices.getUserMedia({ \r\n        video: { \r\n          facingMode: 'environment' // Prefer back camera\r\n        } \r\n      });\r\n      \r\n      // Stop the stream immediately as we just needed permission\r\n      stream.getTracks().forEach(track => track.stop());\r\n      \r\n      setPermissionState('granted');\r\n      message.success('✅ Đã cấp quyền truy cập camera!');\r\n      \r\n      // Now start the scanner\r\n      await startScanner();\r\n      \r\n    } catch (err) {\r\n      console.error('Camera permission denied:', err);\r\n      setPermissionState('denied');\r\n      handleCameraError(err);\r\n    }\r\n  };\r\n\r\n  const handleCameraError = (err) => {\r\n    if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {\r\n      setError('Quyền truy cập camera bị từ chối. Vui lòng cho phép truy cập camera trong cài đặt trình duyệt.');\r\n      setPermissionState('denied');\r\n    } else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {\r\n      setError('Không tìm thấy camera. Vui lòng kiểm tra kết nối camera.');\r\n    } else if (err.name === 'NotSupportedError') {\r\n      setError('Trình duyệt không hỗ trợ truy cập camera.');\r\n    } else if (err.name === 'NotReadableError') {\r\n      setError('Camera đang được sử dụng bởi ứng dụng khác.');\r\n    } else {\r\n      setError(`Lỗi camera: ${err.message || 'Không thể truy cập camera'}`);\r\n    }\r\n  };\r\n\r\n  // 🔧 FIXED: Enhanced startScanner with better error handling and DOM checks\r\n  const startScanner = async () => {\r\n    try {\r\n      setError(null);\r\n      setIsScanning(true);\r\n\r\n      // 🔧 FIXED: Clear any existing scanner first\r\n      if (scannerInstance) {\r\n        await stopScanner();\r\n        // Wait a bit for cleanup to complete\r\n        await new Promise(resolve => setTimeout(resolve, 100));\r\n      }\r\n\r\n      // 🔧 FIXED: Check if DOM element exists before creating scanner\r\n      const container = scannerContainerRef.current;\r\n      if (!container) {\r\n        console.error('QR reader element not found');\r\n        setError('Không thể khởi tạo scanner. Vui lòng thử lại.');\r\n        setIsScanning(false);\r\n        return;\r\n      }\r\n\r\n      // Enhanced configuration for better mobile support\r\n      const config = {\r\n        fps: 10,\r\n        qrbox: function(viewfinderWidth, viewfinderHeight) {\r\n          // Make qrbox responsive\r\n          const minEdgePercentage = 0.7;\r\n          const minEdgeSize = Math.min(viewfinderWidth, viewfinderHeight);\r\n          const qrboxSize = Math.floor(minEdgeSize * minEdgePercentage);\r\n          return {\r\n            width: qrboxSize,\r\n            height: qrboxSize\r\n          };\r\n        },\r\n        aspectRatio: 1.0,\r\n        disableFlip: false,\r\n        // Camera constraints for mobile\r\n        videoConstraints: {\r\n          facingMode: 'environment', // Use back camera\r\n          advanced: [\r\n            { focusMode: 'continuous' },\r\n            { exposureMode: 'continuous' },\r\n            { whiteBalanceMode: 'continuous' }\r\n          ]\r\n        },\r\n        // Support multiple formats using our constants\r\n        formatsToSupport: [\r\n          SUPPORTED_FORMATS.QR_CODE,\r\n          SUPPORTED_FORMATS.CODE_128,\r\n          SUPPORTED_FORMATS.CODE_39,\r\n          SUPPORTED_FORMATS.CODE_93,\r\n          SUPPORTED_FORMATS.EAN_13,\r\n          SUPPORTED_FORMATS.EAN_8,\r\n          SUPPORTED_FORMATS.UPC_A,\r\n          SUPPORTED_FORMATS.UPC_E\r\n        ]\r\n      };\r\n\r\n      console.log('🔧 Creating new QR scanner instance...');\r\n      const scanner = new Html5QrcodeScanner(\r\n        container,\r\n        config,\r\n        false // verbose logging\r\n      );\r\n\r\n      scanner.render(\r\n        (decodedText, decodedResult) => {\r\n          // Success callback\r\n          console.log('✅ QR Code scanned successfully:', decodedText);\r\n          message.success(`📱 Đã quét thành công: ${decodedText}`);\r\n          onScan(decodedText);\r\n          handleClose();\r\n        },\r\n        (error) => {\r\n          // Error callback - only log, don't show to user\r\n          if (error && !error.includes('NotFoundException')) {\r\n            console.warn(`QR scan error: ${error}`);\r\n          }\r\n        }\r\n      );\r\n\r\n      setScannerInstance(scanner);\r\n      setPermissionState('granted');\r\n      console.log('✅ QR scanner started successfully');\r\n\r\n    } catch (err) {\r\n      console.error('Scanner initialization error:', err);\r\n      handleCameraError(err);\r\n      setIsScanning(false);\r\n    }\r\n  };\r\n\r\n  // 🔧 FIXED: Enhanced handleClose with proper cleanup sequence\r\n  const handleClose = async () => {\r\n    console.log('🔄 Closing QR scanner...');\r\n    setIsClosing(true);\r\n    \r\n    try {\r\n      // Stop scanner first\r\n      await stopScanner();\r\n      \r\n      // Reset states\r\n      setError(null);\r\n      setPermissionState('unknown');\r\n      setIsClosing(false);\r\n      \r\n      // Close modal\r\n      onClose();\r\n      \r\n      console.log('✅ QR scanner closed successfully');\r\n    } catch (err) {\r\n      console.error('Error during close:', err);\r\n      setIsClosing(false);\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handleRestart = async () => {\r\n    console.log('🔄 Restarting QR scanner...');\r\n    setError(null);\r\n    await stopScanner();\r\n    \r\n    // Wait a bit before restarting\r\n    setTimeout(() => {\r\n      checkCameraPermission();\r\n    }, 500);\r\n  };\r\n\r\n  // Render permission request UI\r\n  const renderPermissionRequest = () => (\r\n    <div style={{ textAlign: 'center', padding: '40px 20px' }}>\r\n      <div style={{ fontSize: '64px', marginBottom: '20px' }}>📱</div>\r\n      <div style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '12px' }}>\r\n        Cần quyền truy cập Camera\r\n      </div>\r\n      <div style={{ fontSize: '14px', color: '#666', marginBottom: '24px', lineHeight: '1.5' }}>\r\n        Để quét mã QR/Barcode, ứng dụng cần quyền truy cập camera của thiết bị.\r\n        <br />\r\n        Vui lòng bấm \"Cho phép\" khi trình duyệt hỏi.\r\n      </div>\r\n      <Button \r\n        type=\"primary\" \r\n        size=\"large\"\r\n        icon={<CameraOutlined />}\r\n        onClick={requestCameraPermission}\r\n        style={{ \r\n          background: '#52c41a',\r\n          borderColor: '#52c41a',\r\n          height: '48px',\r\n          fontSize: '16px',\r\n          fontWeight: 'bold'\r\n        }}\r\n      >\r\n        🔓 Cấp quyền Camera\r\n      </Button>\r\n      \r\n      <Divider />\r\n      \r\n      <div style={{ fontSize: '12px', color: '#999', textAlign: 'left' }}>\r\n        <div style={{ marginBottom: '8px', fontWeight: 'bold' }}>💡 Lưu ý:</div>\r\n        <div>• Trên <strong>iPhone/iPad</strong>: Bấm \"Cho phép\" khi Safari hỏi</div>\r\n        <div>• Trên <strong>Android</strong>: Bấm \"Allow\" khi Chrome hỏi</div>\r\n        <div>• Nếu đã từ chối: Vào Settings → Camera → Cho phép trang web này</div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n          <CameraOutlined style={{ color: '#1890ff' }} />\r\n          <span>{title}</span>\r\n          {permissionState === 'granted' && (\r\n            <CheckCircleOutlined style={{ color: '#52c41a', marginLeft: '8px' }} />\r\n          )}\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={handleClose}\r\n      width={Math.min(600, window.innerWidth - 32)}\r\n      footer={\r\n        <Space>\r\n          <Button onClick={handleRestart} icon={<ReloadOutlined />} disabled={isClosing}>\r\n            Thử lại\r\n          </Button>\r\n          <Button onClick={handleClose} icon={<CloseOutlined />} disabled={isClosing}>\r\n            Đóng\r\n          </Button>\r\n        </Space>\r\n      }\r\n      // 🔧 FIXED: Removed destroyOnClose to prevent DOM removal conflicts\r\n      centered\r\n      style={{ top: 20 }}\r\n      confirmLoading={isClosing}\r\n    >\r\n      <div style={{ textAlign: 'center', padding: '20px 0' }}>\r\n        {/* Permission request UI */}\r\n        {(permissionState === 'denied' || permissionState === 'prompt' || permissionState === 'unknown') && !scannerInstance && (\r\n          renderPermissionRequest()\r\n        )}\r\n\r\n        {/* Error display */}\r\n        {error && (\r\n          <Alert\r\n            message=\"Lỗi Camera\"\r\n            description={\r\n              <div>\r\n                <div>{error}</div>\r\n                <div style={{ marginTop: '12px', fontSize: '12px' }}>\r\n                  <strong>Cách khắc phục:</strong>\r\n                  <br />• Đảm bảo trang web được truy cập qua HTTPS\r\n                  <br />• Kiểm tra cài đặt quyền camera trong trình duyệt\r\n                  <br />• Thử tải lại trang và cấp quyền lại\r\n                </div>\r\n              </div>\r\n            }\r\n            type=\"error\"\r\n            showIcon\r\n            style={{ marginBottom: 16, textAlign: 'left' }}\r\n            action={\r\n              <Button size=\"small\" onClick={requestCameraPermission}>\r\n                Thử lại\r\n              </Button>\r\n            }\r\n          />\r\n        )}\r\n\r\n        {/* Success message when camera is ready */}\r\n        {permissionState === 'granted' && !error && (\r\n          <Alert\r\n            message=\"Camera đã sẵn sàng\"\r\n            description={placeholder}\r\n            type=\"success\"\r\n            showIcon\r\n            style={{ marginBottom: 16 }}\r\n          />\r\n        )}\r\n\r\n        {/* Scanner container */}\r\n        {permissionState === 'granted' && !error && (\r\n          <div \r\n            ref={scannerContainerRef}\r\n            style={{ \r\n              width: '100%',\r\n              maxWidth: '500px',\r\n              margin: '0 auto',\r\n              border: '2px dashed #52c41a',\r\n              borderRadius: '8px',\r\n              minHeight: '300px',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center'\r\n            }}\r\n          >\r\n            {!scannerInstance && (\r\n              <div style={{ textAlign: 'center', color: '#999' }}>\r\n                <CameraOutlined style={{ fontSize: '48px', marginBottom: '16px' }} />\r\n                <div>Đang khởi tạo camera...</div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n          <Text type=\"secondary\">\r\n            💡 Hỗ trợ quét: QR Code, Code 128, Code 39, EAN-13, UPC-A và nhiều định dạng khác\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default QRScanner; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}