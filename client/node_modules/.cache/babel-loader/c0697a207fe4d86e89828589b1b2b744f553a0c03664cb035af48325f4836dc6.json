{"ast":null,"code":"import _objectSpread from\"C:/Users/ADMIN/Desktop/kho/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Row,Col,Card,Input,Button,List,Typography,message,Modal,Form,InputNumber,Space,Tag,Divider,Spin,Table}from'antd';import{PlusOutlined,MinusOutlined,DeleteOutlined,ShoppingCartOutlined,PrinterOutlined,SearchOutlined,ShoppingOutlined,UserOutlined}from'@ant-design/icons';import{useForm,Controller}from'react-hook-form';import{zodResolver}from'@hookform/resolvers/zod';import*as z from'zod';import{toast,ToastContainer}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import{productsAPI,ordersAPI,customersAPI}from'../services/api';import{formatCurrency}from'../utils/format';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const{Title,Text}=Typography;const{Search}=Input;const orderSchema=z.object({customer_id:z.number().int().positive().optional().nullable(),customer_name:z.string().min(1,'Vui lòng chọn hoặc nhập tên khách hàng.').optional(),customer_phone:z.string().regex(/^[0-9]{10,11}$/,'Số điện thoại không hợp lệ.').optional().or(z.literal('')),notes:z.string().optional()});function POSPage(){const[products,setProducts]=useState([]);const[filteredProducts,setFilteredProducts]=useState([]);const[cart,setCart]=useState([]);const[loading,setLoading]=useState(false);const[orderModalVisible,setOrderModalVisible]=useState(false);const[customerModalVisible,setCustomerModalVisible]=useState(false);const[customers,setCustomers]=useState([]);const[filteredCustomers,setFilteredCustomers]=useState([]);const[selectedCustomer,setSelectedCustomer]=useState(null);const{control,handleSubmit,formState:{errors},setValue,watch,reset}=useForm({resolver:zodResolver(orderSchema),defaultValues:{customer_id:null,customer_name:'',customer_phone:'',notes:''}});const customerPhoneWatch=watch('customer_phone');useEffect(()=>{fetchProducts();fetchCustomers();},[]);useEffect(()=>{if(selectedCustomer){setValue('customer_id',selectedCustomer.id);setValue('customer_name',selectedCustomer.name);setValue('customer_phone',selectedCustomer.phone);}else{setValue('customer_id',null);}},[selectedCustomer,setValue]);const fetchCustomers=async function(){let searchQuery=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';try{const response=await customersAPI.getAll({phone:searchQuery,name:searchQuery});if(response.data.success){setCustomers(response.data.data||[]);setFilteredCustomers(response.data.data||[]);}else{setCustomers([]);toast.error('Lỗi khi lấy danh sách khách hàng: '+response.data.message);}}catch(error){console.error('Error fetching customers:',error);setCustomers([]);toast.error('Lỗi kết nối khi lấy danh sách khách hàng.');}};const handleCustomerSearch=value=>{const filtered=customers.filter(customer=>{var _customer$phone;return customer.name.toLowerCase().includes(value.toLowerCase())||((_customer$phone=customer.phone)===null||_customer$phone===void 0?void 0:_customer$phone.includes(value));});setFilteredCustomers(filtered);};const selectCustomer=customer=>{setSelectedCustomer(customer);setCustomerModalVisible(false);};const clearSelectedCustomer=()=>{setSelectedCustomer(null);setValue('customer_id',null);setValue('customer_name','');setValue('customer_phone','');};const fetchProducts=async()=>{try{setLoading(true);const response=await productsAPI.getAll();if(response.data.success){setProducts(response.data.data||[]);setFilteredProducts(response.data.data||[]);}else{setProducts([]);console.error('API returned error:',response.data.message);}}catch(error){console.error('Error fetching products:',error);setProducts([]);// Don't show error message to user, just silently handle it\n}finally{setLoading(false);}};const handleSearch=value=>{const filtered=products.filter(product=>{var _product$sku,_product$barcode;return product.name.toLowerCase().includes(value.toLowerCase())||((_product$sku=product.sku)===null||_product$sku===void 0?void 0:_product$sku.toLowerCase().includes(value.toLowerCase()))||((_product$barcode=product.barcode)===null||_product$barcode===void 0?void 0:_product$barcode.toLowerCase().includes(value.toLowerCase()));});setFilteredProducts(filtered);};const addToCart=product=>{if(product.quantity<=0){toast.warning('Sản phẩm đã hết hàng');return;}const existingItem=cart.find(item=>item.product_id===product.id);if(existingItem){if(existingItem.quantity>=product.quantity){toast.warning('Không thể thêm, vượt quá số lượng tồn kho');return;}setCart(cart.map(item=>item.product_id===product.id?_objectSpread(_objectSpread({},item),{},{quantity:item.quantity+1}):item));}else{setCart([...cart,{product_id:product.id,name:product.name,price:product.price,quantity:1,max_quantity:product.quantity}]);}};const updateCartQuantity=(product_id,newQuantity)=>{if(newQuantity<=0){removeFromCart(product_id);return;}const product=products.find(p=>p.id===product_id);if(newQuantity>product.quantity){toast.warning('Vượt quá số lượng tồn kho');return;}setCart(cart.map(item=>item.product_id===product_id?_objectSpread(_objectSpread({},item),{},{quantity:newQuantity}):item));};const removeFromCart=product_id=>{setCart(cart.filter(item=>item.product_id!==product_id));};const clearCart=()=>{setCart([]);};const getTotalAmount=()=>{return cart.reduce((total,item)=>total+item.price*item.quantity,0);};const getTotalItems=()=>{return cart.reduce((total,item)=>total+item.quantity,0);};const handleCheckout=()=>{if(cart.length===0){toast.warning('Giỏ hàng trống');return;}setOrderModalVisible(true);};const submitOrder=async values=>{try{setLoading(true);const orderData={customer_name:values.customer_name,customer_phone:values.customer_phone,items:cart.map(item=>({product_id:item.product_id,product_name:item.name,quantity:item.quantity,unit_price:item.price,total_price:item.price*item.quantity})),total_amount:getTotalAmount(),notes:values.notes};const response=await ordersAPI.create(orderData);if(response.data.success){toast.success('Tạo đơn hàng thành công!');reset();setSelectedCustomer(null);clearCart();setOrderModalVisible(false);fetchProducts();showPrintModal(response.data.data);}else{toast.error(response.data.message||'Lỗi khi tạo đơn hàng');}}catch(error){var _error$response,_error$response$data;const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Lỗi kết nối khi tạo đơn hàng.';toast.error(errorMessage);}finally{setLoading(false);}};const showPrintModal=order=>{var _order$customer,_order$customer2,_order$customer3;let modalInstance=null;let autoCloseTimer=null;modalInstance=Modal.info({title:'Hóa đơn bán hàng',width:500,content:/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px 0'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',marginBottom:'20px'},children:[/*#__PURE__*/_jsx(Title,{level:4,children:\"H\\xD3A \\u0110\\u01A0N B\\xC1N H\\xC0NG\"}),/*#__PURE__*/_jsxs(Text,{children:[\"S\\u1ED1 h\\xF3a \\u0111\\u01A1n: \",order.order_number]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:new Date(order.created_at).toLocaleString('vi-VN')})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px'},children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"Kh\\xE1ch h\\xE0ng: \"}),/*#__PURE__*/_jsx(Text,{children:((_order$customer=order.customer)===null||_order$customer===void 0?void 0:_order$customer.name)||order.customer_name}),/*#__PURE__*/_jsx(\"br\",{}),(((_order$customer2=order.customer)===null||_order$customer2===void 0?void 0:_order$customer2.phone)||order.customer_phone)&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i: \"}),/*#__PURE__*/_jsx(Text,{children:((_order$customer3=order.customer)===null||_order$customer3===void 0?void 0:_order$customer3.phone)||order.customer_phone})]})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(List,{size:\"small\",dataSource:order.items,renderItem:item=>/*#__PURE__*/_jsx(List.Item,{style:{padding:'8px 0'},children:/*#__PURE__*/_jsxs(\"div\",{style:{width:'100%',display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Text,{children:item.product_name}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[item.quantity,\" x \",formatCurrency(item.price)]})]}),/*#__PURE__*/_jsx(Text,{strong:true,children:formatCurrency(item.subtotal)})]})})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'right'},children:/*#__PURE__*/_jsxs(Title,{level:4,style:{margin:0},children:[\"T\\u1ED5ng c\\u1ED9ng: \",formatCurrency(order.total_amount)]})})]}),footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(PrinterOutlined,{}),onClick:()=>window.print(),children:\"In h\\xF3a \\u0111\\u01A1n\"},\"print\"),/*#__PURE__*/_jsx(Button,{onClick:()=>{if(modalInstance)modalInstance.destroy();if(autoCloseTimer)clearTimeout(autoCloseTimer);},children:\"\\u0110\\xF3ng\"},\"close\")]});autoCloseTimer=setTimeout(()=>{if(modalInstance)modalInstance.destroy();},5000);};const customerColumns=[{title:'Tên khách hàng',dataIndex:'name',key:'name'},{title:'Số điện thoại',dataIndex:'phone',key:'phone'},{title:'Email',dataIndex:'email',key:'email'},{title:'Địa chỉ',dataIndex:'address',key:'address'},{title:'Hành động',key:'action',render:(_,record)=>/*#__PURE__*/_jsx(Button,{type:\"link\",onClick:()=>selectCustomer(record),children:\"Ch\\u1ECDn\"})}];return/*#__PURE__*/_jsxs(\"div\",{className:\"pos-page\",children:[/*#__PURE__*/_jsxs(Row,{gutter:[16,16],children:[/*#__PURE__*/_jsx(Col,{xs:24,lg:16,children:/*#__PURE__*/_jsx(Card,{title:\"Danh s\\xE1ch s\\u1EA3n ph\\u1EA9m\",extra:/*#__PURE__*/_jsx(Search,{placeholder:\"T\\xECm s\\u1EA3n ph\\u1EA9m...\",onSearch:handleSearch,style:{width:200},loading:loading}),children:loading?/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'50px'},children:/*#__PURE__*/_jsx(Spin,{size:\"large\"})}):/*#__PURE__*/_jsx(List,{grid:{gutter:16,xs:1,sm:2,md:3,lg:3,xl:4,xxl:5},dataSource:filteredProducts,renderItem:product=>/*#__PURE__*/_jsx(List.Item,{children:/*#__PURE__*/_jsxs(Card,{hoverable:true,cover:/*#__PURE__*/_jsx(\"img\",{alt:product.name,src:product.image_url||'https://via.placeholder.com/150'}),onClick:()=>addToCart(product),style:{height:'100%',display:'flex',flexDirection:'column',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Card.Meta,{title:product.name,description:formatCurrency(product.price)}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'10px'},children:[/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[\"T\\u1ED3n kho: \",product.quantity]}),product.quantity<=10&&product.quantity>0&&/*#__PURE__*/_jsx(Tag,{color:\"warning\",style:{marginLeft:'8px'},children:\"S\\u1EAFp h\\u1EBFt\"}),product.quantity===0&&/*#__PURE__*/_jsx(Tag,{color:\"error\",style:{marginLeft:'8px'},children:\"H\\u1EBFt h\\xE0ng\"})]})]})})})})}),/*#__PURE__*/_jsx(Col,{xs:24,lg:8,children:/*#__PURE__*/_jsxs(Card,{title:\"Gi\\u1ECF h\\xE0ng\",actions:[/*#__PURE__*/_jsxs(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(ShoppingCartOutlined,{}),onClick:handleCheckout,disabled:cart.length===0,children:[\"Thanh to\\xE1n (\",getTotalItems(),\")\"]}),/*#__PURE__*/_jsx(Button,{danger:true,icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),onClick:clearCart,disabled:cart.length===0,children:\"X\\xF3a gi\\u1ECF h\\xE0ng\"})],children:[/*#__PURE__*/_jsx(List,{itemLayout:\"horizontal\",dataSource:cart,renderItem:item=>/*#__PURE__*/_jsxs(List.Item,{actions:[/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(PlusOutlined,{}),onClick:()=>updateCartQuantity(item.product_id,item.quantity+1),disabled:item.quantity>=item.max_quantity}),/*#__PURE__*/_jsx(InputNumber,{min:1,max:item.max_quantity,value:item.quantity,onChange:value=>updateCartQuantity(item.product_id,value),style:{width:60}}),/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(MinusOutlined,{}),onClick:()=>updateCartQuantity(item.product_id,item.quantity-1)}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(DeleteOutlined,{style:{color:'red'}}),onClick:()=>removeFromCart(item.product_id)})],children:[/*#__PURE__*/_jsx(List.Item.Meta,{title:item.name,description:formatCurrency(item.price)}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Text,{strong:true,children:formatCurrency(item.price*item.quantity)})})]})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'right'},children:/*#__PURE__*/_jsxs(Title,{level:3,children:[\"T\\u1ED5ng c\\u1ED9ng: \",formatCurrency(getTotalAmount())]})})]})})]}),/*#__PURE__*/_jsx(Modal,{title:\"T\\u1EA1o \\u0111\\u01A1n h\\xE0ng\",visible:orderModalVisible,onCancel:()=>setOrderModalVisible(false),footer:null,width:600,children:/*#__PURE__*/_jsxs(Form,{layout:\"vertical\",onFinish:handleSubmit(submitOrder),children:[/*#__PURE__*/_jsx(Form.Item,{label:\"Kh\\xE1ch h\\xE0ng\",children:selectedCustomer?/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Text,{strong:true,children:selectedCustomer.name}),/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[\"(\",selectedCustomer.phone,\")\"]}),/*#__PURE__*/_jsx(Button,{size:\"small\",onClick:clearSelectedCustomer,children:\"X\\xF3a\"})]}):/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(UserOutlined,{}),onClick:()=>setCustomerModalVisible(true),children:\"Ch\\u1ECDn kh\\xE1ch h\\xE0ng\"})}),!selectedCustomer&&/*#__PURE__*/_jsx(Controller,{name:\"customer_phone\",control:control,render:_ref=>{var _errors$customer_phon;let{field}=_ref;return/*#__PURE__*/_jsx(Form.Item,{label:\"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i kh\\xE1ch h\\xE0ng\",help:(_errors$customer_phon=errors.customer_phone)===null||_errors$customer_phon===void 0?void 0:_errors$customer_phon.message,validateStatus:errors.customer_phone?'error':'',children:/*#__PURE__*/_jsx(Search,_objectSpread(_objectSpread({},field),{},{id:\"customer_phone\",name:\"customer_phone\",placeholder:\"T\\xECm kh\\xE1ch h\\xE0ng theo S\\u0110T ho\\u1EB7c nh\\u1EADp m\\u1EDBi\",onSearch:value=>{const foundCustomer=customers.find(c=>c.phone===value);if(foundCustomer){selectCustomer(foundCustomer);toast.success(\"\\u0110\\xE3 t\\xECm th\\u1EA5y kh\\xE1ch h\\xE0ng: \".concat(foundCustomer.name));}else if(value){toast.info('Không tìm thấy khách hàng với SĐT này. Vui lòng nhập tên mới.');setValue('customer_name','');}field.onChange(value);},enterButton:/*#__PURE__*/_jsx(SearchOutlined,{})}))});}}),!selectedCustomer&&!customerPhoneWatch&&/*#__PURE__*/_jsx(Controller,{name:\"customer_name\",control:control,render:_ref2=>{var _errors$customer_name;let{field}=_ref2;return/*#__PURE__*/_jsx(Form.Item,{label:\"T\\xEAn kh\\xE1ch h\\xE0ng (N\\u1EBFu kh\\xF4ng c\\xF3 S\\u0110T)\",help:(_errors$customer_name=errors.customer_name)===null||_errors$customer_name===void 0?void 0:_errors$customer_name.message,validateStatus:errors.customer_name?'error':'',children:/*#__PURE__*/_jsx(Input,_objectSpread(_objectSpread({},field),{},{id:\"customer_name\",name:\"customer_name\",placeholder:\"Nh\\u1EADp t\\xEAn kh\\xE1ch h\\xE0ng\"}))});}}),/*#__PURE__*/_jsx(Controller,{name:\"notes\",control:control,render:_ref3=>{let{field}=_ref3;return/*#__PURE__*/_jsx(Form.Item,{label:\"Ghi ch\\xFA\",children:/*#__PURE__*/_jsx(Input.TextArea,_objectSpread(_objectSpread({},field),{},{id:\"notes\",name:\"notes\",rows:3,placeholder:\"Ghi ch\\xFA v\\u1EC1 \\u0111\\u01A1n h\\xE0ng\"}))});}}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'right',marginBottom:'20px'},children:/*#__PURE__*/_jsxs(Title,{level:4,children:[\"T\\u1ED5ng ti\\u1EC1n: \",formatCurrency(getTotalAmount())]})}),/*#__PURE__*/_jsx(Form.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",block:true,loading:loading,children:\"Ho\\xE0n t\\u1EA5t \\u0111\\u01A1n h\\xE0ng\"})})]})}),/*#__PURE__*/_jsxs(Modal,{title:\"Ch\\u1ECDn kh\\xE1ch h\\xE0ng\",visible:customerModalVisible,onCancel:()=>setCustomerModalVisible(false),footer:null,width:800,children:[/*#__PURE__*/_jsx(Search,{placeholder:\"T\\xECm kh\\xE1ch h\\xE0ng theo t\\xEAn ho\\u1EB7c s\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i...\",onSearch:handleCustomerSearch,style:{marginBottom:16}}),/*#__PURE__*/_jsx(Table,{dataSource:filteredCustomers,columns:customerColumns,rowKey:\"id\",pagination:{pageSize:5},scroll:{y:300}})]}),/*#__PURE__*/_jsx(ToastContainer,{position:\"bottom-right\",autoClose:3000,hideProgressBar:false,newestOnTop:false,closeOnClick:true,rtl:false,pauseOnFocusLoss:true,draggable:true,pauseOnHover:true})]});}export default POSPage;","map":{"version":3,"names":["React","useState","useEffect","Row","Col","Card","Input","Button","List","Typography","message","Modal","Form","InputNumber","Space","Tag","Divider","Spin","Table","PlusOutlined","MinusOutlined","DeleteOutlined","ShoppingCartOutlined","PrinterOutlined","SearchOutlined","ShoppingOutlined","UserOutlined","useForm","Controller","zodResolver","z","toast","ToastContainer","productsAPI","ordersAPI","customersAPI","formatCurrency","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Title","Text","Search","orderSchema","object","customer_id","number","int","positive","optional","nullable","customer_name","string","min","customer_phone","regex","or","literal","notes","POSPage","products","setProducts","filteredProducts","setFilteredProducts","cart","setCart","loading","setLoading","orderModalVisible","setOrderModalVisible","customerModalVisible","setCustomerModalVisible","customers","setCustomers","filteredCustomers","setFilteredCustomers","selectedCustomer","setSelectedCustomer","control","handleSubmit","formState","errors","setValue","watch","reset","resolver","defaultValues","customerPhoneWatch","fetchProducts","fetchCustomers","id","name","phone","searchQuery","arguments","length","undefined","response","getAll","data","success","error","console","handleCustomerSearch","value","filtered","filter","customer","_customer$phone","toLowerCase","includes","selectCustomer","clearSelectedCustomer","handleSearch","product","_product$sku","_product$barcode","sku","barcode","addToCart","quantity","warning","existingItem","find","item","product_id","map","_objectSpread","price","max_quantity","updateCartQuantity","newQuantity","removeFromCart","p","clearCart","getTotalAmount","reduce","total","getTotalItems","handleCheckout","submitOrder","values","orderData","items","product_name","unit_price","total_price","total_amount","create","showPrintModal","_error$response","_error$response$data","errorMessage","order","_order$customer","_order$customer2","_order$customer3","modalInstance","autoCloseTimer","info","title","width","content","style","padding","children","textAlign","marginBottom","level","order_number","type","Date","created_at","toLocaleString","strong","size","dataSource","renderItem","Item","display","justifyContent","subtotal","margin","footer","icon","onClick","window","print","destroy","clearTimeout","setTimeout","customerColumns","dataIndex","key","render","_","record","className","gutter","xs","lg","extra","placeholder","onSearch","grid","sm","md","xl","xxl","hoverable","cover","alt","src","image_url","height","flexDirection","Meta","description","marginTop","color","marginLeft","actions","disabled","danger","itemLayout","max","onChange","visible","onCancel","layout","onFinish","label","_ref","_errors$customer_phon","field","help","validateStatus","foundCustomer","c","concat","enterButton","_ref2","_errors$customer_name","_ref3","TextArea","rows","htmlType","block","columns","rowKey","pagination","pageSize","scroll","y","position","autoClose","hideProgressBar","newestOnTop","closeOnClick","rtl","pauseOnFocusLoss","draggable","pauseOnHover"],"sources":["C:/Users/ADMIN/Desktop/kho/client/src/pages/POSPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Row, \r\n  Col, \r\n  Card, \r\n  Input, \r\n  Button, \r\n  List, \r\n  Typography, \r\n  message, \r\n  Modal,\r\n  Form,\r\n  InputNumber,\r\n  Space,\r\n  Tag,\r\n  Divider,\r\n  Spin,\r\n  Table\r\n} from 'antd';\r\nimport { \r\n  PlusOutlined, \r\n  MinusOutlined, \r\n  DeleteOutlined,\r\n  ShoppingCartOutlined,\r\n  PrinterOutlined,\r\n  SearchOutlined,\r\n  ShoppingOutlined,\r\n  UserOutlined\r\n} from '@ant-design/icons';\r\nimport { useForm, Controller } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport * as z from 'zod';\r\nimport { toast, ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\n\r\nimport { productsAPI, ordersAPI, customersAPI } from '../services/api';\r\nimport { formatCurrency } from '../utils/format';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Search } = Input;\r\n\r\nconst orderSchema = z.object({\r\n  customer_id: z.number().int().positive().optional().nullable(),\r\n  customer_name: z.string().min(1, 'Vui lòng chọn hoặc nhập tên khách hàng.').optional(),\r\n  customer_phone: z.string().regex(/^[0-9]{10,11}$/, 'Số điện thoại không hợp lệ.').optional().or(z.literal('')),\r\n  notes: z.string().optional(),\r\n});\r\n\r\nfunction POSPage() {\r\n  const [products, setProducts] = useState([]);\r\n  const [filteredProducts, setFilteredProducts] = useState([]);\r\n  const [cart, setCart] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [orderModalVisible, setOrderModalVisible] = useState(false);\r\n  const [customerModalVisible, setCustomerModalVisible] = useState(false);\r\n  const [customers, setCustomers] = useState([]);\r\n  const [filteredCustomers, setFilteredCustomers] = useState([]);\r\n  const [selectedCustomer, setSelectedCustomer] = useState(null);\r\n\r\n  const { control, handleSubmit, formState: { errors }, setValue, watch, reset } = useForm({\r\n    resolver: zodResolver(orderSchema),\r\n    defaultValues: {\r\n      customer_id: null,\r\n      customer_name: '',\r\n      customer_phone: '',\r\n      notes: '',\r\n    }\r\n  });\r\n\r\n  const customerPhoneWatch = watch('customer_phone');\r\n\r\n  useEffect(() => {\r\n    fetchProducts();\r\n    fetchCustomers();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selectedCustomer) {\r\n      setValue('customer_id', selectedCustomer.id);\r\n      setValue('customer_name', selectedCustomer.name);\r\n      setValue('customer_phone', selectedCustomer.phone);\r\n    } else {\r\n      setValue('customer_id', null);\r\n    }\r\n  }, [selectedCustomer, setValue]);\r\n\r\n  const fetchCustomers = async (searchQuery = '') => {\r\n    try {\r\n      const response = await customersAPI.getAll({ phone: searchQuery, name: searchQuery });\r\n      if (\r\n        response.data.success) {\r\n        setCustomers(response.data.data || []);\r\n        setFilteredCustomers(response.data.data || []);\r\n      } else {\r\n        setCustomers([]);\r\n        toast.error('Lỗi khi lấy danh sách khách hàng: ' + response.data.message);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching customers:', error);\r\n      setCustomers([]);\r\n      toast.error('Lỗi kết nối khi lấy danh sách khách hàng.');\r\n    }\r\n  };\r\n\r\n  const handleCustomerSearch = (value) => {\r\n    const filtered = customers.filter(customer =>\r\n      customer.name.toLowerCase().includes(value.toLowerCase()) ||\r\n      customer.phone?.includes(value)\r\n    );\r\n    setFilteredCustomers(filtered);\r\n  };\r\n\r\n  const selectCustomer = (customer) => {\r\n    setSelectedCustomer(customer);\r\n    setCustomerModalVisible(false);\r\n  };\r\n\r\n  const clearSelectedCustomer = () => {\r\n    setSelectedCustomer(null);\r\n    setValue('customer_id', null);\r\n    setValue('customer_name', '');\r\n    setValue('customer_phone', '');\r\n  };\r\n\r\n  const fetchProducts = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await productsAPI.getAll();\r\n      if (response.data.success) {\r\n        setProducts(response.data.data || []);\r\n        setFilteredProducts(response.data.data || []);\r\n      } else {\r\n        setProducts([]);\r\n        console.error('API returned error:', response.data.message);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching products:', error);\r\n      setProducts([]);\r\n      // Don't show error message to user, just silently handle it\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSearch = (value) => {\r\n    const filtered = products.filter(product =>\r\n      product.name.toLowerCase().includes(value.toLowerCase()) ||\r\n      product.sku?.toLowerCase().includes(value.toLowerCase()) ||\r\n      product.barcode?.toLowerCase().includes(value.toLowerCase())\r\n    );\r\n    setFilteredProducts(filtered);\r\n  };\r\n\r\n  const addToCart = (product) => {\r\n    if (product.quantity <= 0) {\r\n      toast.warning('Sản phẩm đã hết hàng');\r\n      return;\r\n    }\r\n\r\n    const existingItem = cart.find(item => item.product_id === product.id);\r\n    \r\n    if (existingItem) {\r\n      if (existingItem.quantity >= product.quantity) {\r\n        toast.warning('Không thể thêm, vượt quá số lượng tồn kho');\r\n        return;\r\n      }\r\n      setCart(cart.map(item =>\r\n        item.product_id === product.id\r\n          ? { ...item, quantity: item.quantity + 1 }\r\n          : item\r\n      ));\r\n    } else {\r\n      setCart([...cart, {\r\n        product_id: product.id,\r\n        name: product.name,\r\n        price: product.price,\r\n        quantity: 1,\r\n        max_quantity: product.quantity\r\n      }]);\r\n    }\r\n  };\r\n\r\n  const updateCartQuantity = (product_id, newQuantity) => {\r\n    if (newQuantity <= 0) {\r\n      removeFromCart(product_id);\r\n      return;\r\n    }\r\n\r\n    const product = products.find(p => p.id === product_id);\r\n    if (newQuantity > product.quantity) {\r\n      toast.warning('Vượt quá số lượng tồn kho');\r\n      return;\r\n    }\r\n\r\n    setCart(cart.map(item =>\r\n      item.product_id === product_id\r\n        ? { ...item, quantity: newQuantity }\r\n        : item\r\n    ));\r\n  };\r\n\r\n  const removeFromCart = (product_id) => {\r\n    setCart(cart.filter(item => item.product_id !== product_id));\r\n  };\r\n\r\n  const clearCart = () => {\r\n    setCart([]);\r\n  };\r\n\r\n  const getTotalAmount = () => {\r\n    return cart.reduce((total, item) => total + (item.price * item.quantity), 0);\r\n  };\r\n\r\n  const getTotalItems = () => {\r\n    return cart.reduce((total, item) => total + item.quantity, 0);\r\n  };\r\n\r\n  const handleCheckout = () => {\r\n    if (cart.length === 0) {\r\n      toast.warning('Giỏ hàng trống');\r\n      return;\r\n    }\r\n    setOrderModalVisible(true);\r\n  };\r\n\r\n  const submitOrder = async (values) => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      const orderData = {\r\n        customer_name: values.customer_name,\r\n        customer_phone: values.customer_phone,\r\n        items: cart.map(item => ({\r\n          product_id: item.product_id,\r\n          product_name: item.name,\r\n          quantity: item.quantity,\r\n          unit_price: item.price,\r\n          total_price: item.price * item.quantity\r\n        })),\r\n        total_amount: getTotalAmount(),\r\n        notes: values.notes,\r\n      };\r\n\r\n      const response = await ordersAPI.create(orderData);\r\n      \r\n      if (response.data.success) {\r\n        toast.success('Tạo đơn hàng thành công!');\r\n        \r\n        reset();\r\n        setSelectedCustomer(null);\r\n        clearCart();\r\n        setOrderModalVisible(false);\r\n        \r\n        fetchProducts();\r\n        \r\n        showPrintModal(response.data.data);\r\n      } else {\r\n        toast.error(response.data.message || 'Lỗi khi tạo đơn hàng');\r\n      }\r\n    } catch (error) {\r\n      const errorMessage = error.response?.data?.message || 'Lỗi kết nối khi tạo đơn hàng.';\r\n      toast.error(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const showPrintModal = (order) => {\r\n    let modalInstance = null;\r\n    let autoCloseTimer = null;\r\n    modalInstance = Modal.info({\r\n      title: 'Hóa đơn bán hàng',\r\n      width: 500,\r\n      content: (\r\n        <div style={{ padding: '20px 0' }}>\r\n          <div style={{ textAlign: 'center', marginBottom: '20px' }}>\r\n            <Title level={4}>HÓA ĐƠN BÁN HÀNG</Title>\r\n            <Text>Số hóa đơn: {order.order_number}</Text><br/>\r\n            <Text type=\"secondary\">\r\n              {new Date(order.created_at).toLocaleString('vi-VN')}\r\n            </Text>\r\n          </div>\r\n          <Divider />\r\n          <div style={{ marginBottom: '16px' }}>\r\n            <Text strong>Khách hàng: </Text>\r\n            <Text>{order.customer?.name || order.customer_name}</Text><br/>\r\n            {(order.customer?.phone || order.customer_phone) && (\r\n              <>\r\n                <Text strong>Số điện thoại: </Text>\r\n                <Text>{order.customer?.phone || order.customer_phone}</Text>\r\n              </>\r\n            )}\r\n          </div>\r\n          <Divider />\r\n          <List\r\n            size=\"small\"\r\n            dataSource={order.items}\r\n            renderItem={item => (\r\n              <List.Item style={{ padding: '8px 0' }}>\r\n                <div style={{ width: '100%', display: 'flex', justifyContent: 'space-between' }}>\r\n                  <div>\r\n                    <Text>{item.product_name}</Text><br/>\r\n                    <Text type=\"secondary\">{item.quantity} x {formatCurrency(item.price)}</Text>\r\n                  </div>\r\n                  <Text strong>{formatCurrency(item.subtotal)}</Text>\r\n                </div>\r\n              </List.Item>\r\n            )}\r\n          />\r\n          <Divider />\r\n          <div style={{ textAlign: 'right' }}>\r\n            <Title level={4} style={{ margin: 0 }}>\r\n              Tổng cộng: {formatCurrency(order.total_amount)}\r\n            </Title>\r\n          </div>\r\n        </div>\r\n      ),\r\n      footer: [\r\n        <Button \r\n          key=\"print\"\r\n          type=\"primary\" \r\n          icon={<PrinterOutlined />}\r\n          onClick={() => window.print()}\r\n        >\r\n          In hóa đơn\r\n        </Button>,\r\n        <Button\r\n          key=\"close\"\r\n          onClick={() => { if (modalInstance) modalInstance.destroy(); if (autoCloseTimer) clearTimeout(autoCloseTimer); }}\r\n        >\r\n          Đóng\r\n        </Button>\r\n      ]\r\n    });\r\n    autoCloseTimer = setTimeout(() => {\r\n      if (modalInstance) modalInstance.destroy();\r\n    }, 5000);\r\n  };\r\n\r\n  const customerColumns = [\r\n    {\r\n      title: 'Tên khách hàng',\r\n      dataIndex: 'name',\r\n      key: 'name',\r\n    },\r\n    {\r\n      title: 'Số điện thoại',\r\n      dataIndex: 'phone',\r\n      key: 'phone',\r\n    },\r\n    {\r\n      title: 'Email',\r\n      dataIndex: 'email',\r\n      key: 'email',\r\n    },\r\n    {\r\n      title: 'Địa chỉ',\r\n      dataIndex: 'address',\r\n      key: 'address',\r\n    },\r\n    {\r\n      title: 'Hành động',\r\n      key: 'action',\r\n      render: (_, record) => (\r\n        <Button type=\"link\" onClick={() => selectCustomer(record)}>Chọn</Button>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"pos-page\">\r\n      <Row gutter={[16, 16]}>\r\n        <Col xs={24} lg={16}>\r\n          <Card \r\n            title=\"Danh sách sản phẩm\"\r\n            extra={\r\n              <Search\r\n                placeholder=\"Tìm sản phẩm...\"\r\n                onSearch={handleSearch}\r\n                style={{ width: 200 }}\r\n                loading={loading}\r\n              />\r\n            }\r\n          >\r\n            {loading ? (\r\n              <div style={{ textAlign: 'center', padding: '50px' }}>\r\n                <Spin size=\"large\" />\r\n              </div>\r\n            ) : (\r\n              <List\r\n                grid={{ gutter: 16, xs: 1, sm: 2, md: 3, lg: 3, xl: 4, xxl: 5 }}\r\n                dataSource={filteredProducts}\r\n                renderItem={product => (\r\n                  <List.Item>\r\n                    <Card\r\n                      hoverable\r\n                      cover={<img alt={product.name} src={product.image_url || 'https://via.placeholder.com/150'} />}\r\n                      onClick={() => addToCart(product)}\r\n                      style={{ height: '100%', display: 'flex', flexDirection: 'column', justifyContent: 'space-between' }}\r\n                    >\r\n                      <Card.Meta \r\n                        title={product.name}\r\n                        description={formatCurrency(product.price)}\r\n                      />\r\n                      <div style={{ marginTop: '10px' }}>\r\n                        <Text type=\"secondary\">Tồn kho: {product.quantity}</Text>\r\n                        {product.quantity <= 10 && product.quantity > 0 && (\r\n                          <Tag color=\"warning\" style={{ marginLeft: '8px' }}>Sắp hết</Tag>\r\n                        )}\r\n                        {product.quantity === 0 && (\r\n                          <Tag color=\"error\" style={{ marginLeft: '8px' }}>Hết hàng</Tag>\r\n                        )}\r\n                      </div>\r\n                    </Card>\r\n                  </List.Item>\r\n                )}\r\n              />\r\n            )}\r\n          </Card>\r\n        </Col>\r\n\r\n        <Col xs={24} lg={8}>\r\n          <Card\r\n            title=\"Giỏ hàng\"\r\n            actions={[\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<ShoppingCartOutlined />}\r\n                onClick={handleCheckout}\r\n                disabled={cart.length === 0}\r\n              >\r\n                Thanh toán ({getTotalItems()})\r\n              </Button>,\r\n              <Button\r\n                danger\r\n                icon={<DeleteOutlined />}\r\n                onClick={clearCart}\r\n                disabled={cart.length === 0}\r\n              >\r\n                Xóa giỏ hàng\r\n              </Button>,\r\n            ]}\r\n          >\r\n            <List\r\n              itemLayout=\"horizontal\"\r\n              dataSource={cart}\r\n              renderItem={item => (\r\n                <List.Item\r\n                  actions={[\r\n                    <Button \r\n                      icon={<PlusOutlined />} \r\n                      onClick={() => updateCartQuantity(item.product_id, item.quantity + 1)}\r\n                      disabled={item.quantity >= item.max_quantity}\r\n                    />,\r\n                    <InputNumber\r\n                      min={1}\r\n                      max={item.max_quantity}\r\n                      value={item.quantity}\r\n                      onChange={(value) => updateCartQuantity(item.product_id, value)}\r\n                      style={{ width: 60 }}\r\n                    />,\r\n                    <Button \r\n                      icon={<MinusOutlined />} \r\n                      onClick={() => updateCartQuantity(item.product_id, item.quantity - 1)}\r\n                    />,\r\n                    <Button \r\n                      type=\"text\" \r\n                      icon={<DeleteOutlined style={{ color: 'red' }} />} \r\n                      onClick={() => removeFromCart(item.product_id)}\r\n                    />\r\n                  ]}\r\n                >\r\n                  <List.Item.Meta\r\n                    title={item.name}\r\n                    description={formatCurrency(item.price)}\r\n                  />\r\n                  <div>\r\n                    <Text strong>{formatCurrency(item.price * item.quantity)}</Text>\r\n                  </div>\r\n                </List.Item>\r\n              )}\r\n            />\r\n            <Divider />\r\n            <div style={{ textAlign: 'right' }}>\r\n              <Title level={3}>Tổng cộng: {formatCurrency(getTotalAmount())}</Title>\r\n            </div>\r\n          </Card>\r\n        </Col>\r\n      </Row>\r\n\r\n      <Modal\r\n        title=\"Tạo đơn hàng\"\r\n        visible={orderModalVisible}\r\n        onCancel={() => setOrderModalVisible(false)}\r\n        footer={null}\r\n        width={600}\r\n      >\r\n        <Form layout=\"vertical\" onFinish={handleSubmit(submitOrder)}>\r\n          <Form.Item label=\"Khách hàng\">\r\n            {selectedCustomer ? (\r\n              <Space>\r\n                <Text strong>{selectedCustomer.name}</Text>\r\n                <Text type=\"secondary\">({selectedCustomer.phone})</Text>\r\n                <Button size=\"small\" onClick={clearSelectedCustomer}>Xóa</Button>\r\n              </Space>\r\n            ) : (\r\n              <Button \r\n                icon={<UserOutlined />} \r\n                onClick={() => setCustomerModalVisible(true)}\r\n              >\r\n                Chọn khách hàng\r\n              </Button>\r\n            )}\r\n          </Form.Item>\r\n\r\n          {!selectedCustomer && (\r\n            <Controller\r\n              name=\"customer_phone\"\r\n              control={control}\r\n              render={({ field }) => (\r\n                <Form.Item label=\"Số điện thoại khách hàng\" help={errors.customer_phone?.message} validateStatus={errors.customer_phone ? 'error' : ''}>\r\n                  <Search\r\n                    {...field}\r\n                    id=\"customer_phone\"\r\n                    name=\"customer_phone\"\r\n                    placeholder=\"Tìm khách hàng theo SĐT hoặc nhập mới\"\r\n                    onSearch={(value) => {\r\n                      const foundCustomer = customers.find(c => c.phone === value);\r\n                      if (foundCustomer) {\r\n                        selectCustomer(foundCustomer);\r\n                        toast.success(`Đã tìm thấy khách hàng: ${foundCustomer.name}`);\r\n                      } else if (value) {\r\n                        toast.info('Không tìm thấy khách hàng với SĐT này. Vui lòng nhập tên mới.');\r\n                        setValue('customer_name', '');\r\n                      }\r\n                      field.onChange(value);\r\n                    }}\r\n                    enterButton={<SearchOutlined />}\r\n                  />\r\n                </Form.Item>\r\n              )}\r\n            />\r\n          )}\r\n\r\n          {!selectedCustomer && !customerPhoneWatch && (\r\n            <Controller\r\n              name=\"customer_name\"\r\n              control={control}\r\n              render={({ field }) => (\r\n                <Form.Item label=\"Tên khách hàng (Nếu không có SĐT)\" help={errors.customer_name?.message} validateStatus={errors.customer_name ? 'error' : ''}>\r\n                  <Input {...field} id=\"customer_name\" name=\"customer_name\" placeholder=\"Nhập tên khách hàng\" />\r\n                </Form.Item>\r\n              )}\r\n            />\r\n          )}\r\n\r\n          <Controller\r\n            name=\"notes\"\r\n            control={control}\r\n            render={({ field }) => (\r\n              <Form.Item label=\"Ghi chú\">\r\n                <Input.TextArea {...field} id=\"notes\" name=\"notes\" rows={3} placeholder=\"Ghi chú về đơn hàng\" />\r\n              </Form.Item>\r\n            )}\r\n          />\r\n\r\n          <Divider />\r\n\r\n          <div style={{ textAlign: 'right', marginBottom: '20px' }}>\r\n            <Title level={4}>Tổng tiền: {formatCurrency(getTotalAmount())}</Title>\r\n          </div>\r\n\r\n          <Form.Item>\r\n            <Button type=\"primary\" htmlType=\"submit\" block loading={loading}>\r\n              Hoàn tất đơn hàng\r\n            </Button>\r\n          </Form.Item>\r\n        </Form>\r\n      </Modal>\r\n\r\n      <Modal\r\n        title=\"Chọn khách hàng\"\r\n        visible={customerModalVisible}\r\n        onCancel={() => setCustomerModalVisible(false)}\r\n        footer={null}\r\n        width={800}\r\n      >\r\n        <Search\r\n          placeholder=\"Tìm khách hàng theo tên hoặc số điện thoại...\"\r\n          onSearch={handleCustomerSearch}\r\n          style={{ marginBottom: 16 }}\r\n        />\r\n        <Table\r\n          dataSource={filteredCustomers}\r\n          columns={customerColumns}\r\n          rowKey=\"id\"\r\n          pagination={{ pageSize: 5 }}\r\n          scroll={{ y: 300 }}\r\n        />\r\n      </Modal>\r\n      <ToastContainer position=\"bottom-right\" autoClose={3000} hideProgressBar={false} newestOnTop={false} closeOnClick rtl={false} pauseOnFocusLoss draggable pauseOnHover />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default POSPage; "],"mappings":"sHAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OACEC,GAAG,CACHC,GAAG,CACHC,IAAI,CACJC,KAAK,CACLC,MAAM,CACNC,IAAI,CACJC,UAAU,CACVC,OAAO,CACPC,KAAK,CACLC,IAAI,CACJC,WAAW,CACXC,KAAK,CACLC,GAAG,CACHC,OAAO,CACPC,IAAI,CACJC,KAAK,KACA,MAAM,CACb,OACEC,YAAY,CACZC,aAAa,CACbC,cAAc,CACdC,oBAAoB,CACpBC,eAAe,CACfC,cAAc,CACdC,gBAAgB,CAChBC,YAAY,KACP,mBAAmB,CAC1B,OAASC,OAAO,CAAEC,UAAU,KAAQ,iBAAiB,CACrD,OAASC,WAAW,KAAQ,yBAAyB,CACrD,MAAO,GAAK,CAAAC,CAAC,KAAM,KAAK,CACxB,OAASC,KAAK,CAAEC,cAAc,KAAQ,gBAAgB,CACtD,MAAO,uCAAuC,CAE9C,OAASC,WAAW,CAAEC,SAAS,CAAEC,YAAY,KAAQ,iBAAiB,CACtE,OAASC,cAAc,KAAQ,iBAAiB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAEjD,KAAM,CAAEC,KAAK,CAAEC,IAAK,CAAC,CAAGnC,UAAU,CAClC,KAAM,CAAEoC,MAAO,CAAC,CAAGvC,KAAK,CAExB,KAAM,CAAAwC,WAAW,CAAGhB,CAAC,CAACiB,MAAM,CAAC,CAC3BC,WAAW,CAAElB,CAAC,CAACmB,MAAM,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAC9DC,aAAa,CAAExB,CAAC,CAACyB,MAAM,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC,CAAE,yCAAyC,CAAC,CAACJ,QAAQ,CAAC,CAAC,CACtFK,cAAc,CAAE3B,CAAC,CAACyB,MAAM,CAAC,CAAC,CAACG,KAAK,CAAC,gBAAgB,CAAE,6BAA6B,CAAC,CAACN,QAAQ,CAAC,CAAC,CAACO,EAAE,CAAC7B,CAAC,CAAC8B,OAAO,CAAC,EAAE,CAAC,CAAC,CAC9GC,KAAK,CAAE/B,CAAC,CAACyB,MAAM,CAAC,CAAC,CAACH,QAAQ,CAAC,CAC7B,CAAC,CAAC,CAEF,QAAS,CAAAU,OAAOA,CAAA,CAAG,CACjB,KAAM,CAACC,QAAQ,CAAEC,WAAW,CAAC,CAAG/D,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACgE,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGjE,QAAQ,CAAC,EAAE,CAAC,CAC5D,KAAM,CAACkE,IAAI,CAAEC,OAAO,CAAC,CAAGnE,QAAQ,CAAC,EAAE,CAAC,CACpC,KAAM,CAACoE,OAAO,CAAEC,UAAU,CAAC,CAAGrE,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACsE,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGvE,QAAQ,CAAC,KAAK,CAAC,CACjE,KAAM,CAACwE,oBAAoB,CAAEC,uBAAuB,CAAC,CAAGzE,QAAQ,CAAC,KAAK,CAAC,CACvE,KAAM,CAAC0E,SAAS,CAAEC,YAAY,CAAC,CAAG3E,QAAQ,CAAC,EAAE,CAAC,CAC9C,KAAM,CAAC4E,iBAAiB,CAAEC,oBAAoB,CAAC,CAAG7E,QAAQ,CAAC,EAAE,CAAC,CAC9D,KAAM,CAAC8E,gBAAgB,CAAEC,mBAAmB,CAAC,CAAG/E,QAAQ,CAAC,IAAI,CAAC,CAE9D,KAAM,CAAEgF,OAAO,CAAEC,YAAY,CAAEC,SAAS,CAAE,CAAEC,MAAO,CAAC,CAAEC,QAAQ,CAAEC,KAAK,CAAEC,KAAM,CAAC,CAAG5D,OAAO,CAAC,CACvF6D,QAAQ,CAAE3D,WAAW,CAACiB,WAAW,CAAC,CAClC2C,aAAa,CAAE,CACbzC,WAAW,CAAE,IAAI,CACjBM,aAAa,CAAE,EAAE,CACjBG,cAAc,CAAE,EAAE,CAClBI,KAAK,CAAE,EACT,CACF,CAAC,CAAC,CAEF,KAAM,CAAA6B,kBAAkB,CAAGJ,KAAK,CAAC,gBAAgB,CAAC,CAElDpF,SAAS,CAAC,IAAM,CACdyF,aAAa,CAAC,CAAC,CACfC,cAAc,CAAC,CAAC,CAClB,CAAC,CAAE,EAAE,CAAC,CAEN1F,SAAS,CAAC,IAAM,CACd,GAAI6E,gBAAgB,CAAE,CACpBM,QAAQ,CAAC,aAAa,CAAEN,gBAAgB,CAACc,EAAE,CAAC,CAC5CR,QAAQ,CAAC,eAAe,CAAEN,gBAAgB,CAACe,IAAI,CAAC,CAChDT,QAAQ,CAAC,gBAAgB,CAAEN,gBAAgB,CAACgB,KAAK,CAAC,CACpD,CAAC,IAAM,CACLV,QAAQ,CAAC,aAAa,CAAE,IAAI,CAAC,CAC/B,CACF,CAAC,CAAE,CAACN,gBAAgB,CAAEM,QAAQ,CAAC,CAAC,CAEhC,KAAM,CAAAO,cAAc,CAAG,cAAAA,CAAA,CAA4B,IAArB,CAAAI,WAAW,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,EAAE,CAC5C,GAAI,CACF,KAAM,CAAAG,QAAQ,CAAG,KAAM,CAAAjE,YAAY,CAACkE,MAAM,CAAC,CAAEN,KAAK,CAAEC,WAAW,CAAEF,IAAI,CAAEE,WAAY,CAAC,CAAC,CACrF,GACEI,QAAQ,CAACE,IAAI,CAACC,OAAO,CAAE,CACvB3B,YAAY,CAACwB,QAAQ,CAACE,IAAI,CAACA,IAAI,EAAI,EAAE,CAAC,CACtCxB,oBAAoB,CAACsB,QAAQ,CAACE,IAAI,CAACA,IAAI,EAAI,EAAE,CAAC,CAChD,CAAC,IAAM,CACL1B,YAAY,CAAC,EAAE,CAAC,CAChB7C,KAAK,CAACyE,KAAK,CAAC,oCAAoC,CAAGJ,QAAQ,CAACE,IAAI,CAAC5F,OAAO,CAAC,CAC3E,CACF,CAAE,MAAO8F,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,2BAA2B,CAAEA,KAAK,CAAC,CACjD5B,YAAY,CAAC,EAAE,CAAC,CAChB7C,KAAK,CAACyE,KAAK,CAAC,2CAA2C,CAAC,CAC1D,CACF,CAAC,CAED,KAAM,CAAAE,oBAAoB,CAAIC,KAAK,EAAK,CACtC,KAAM,CAAAC,QAAQ,CAAGjC,SAAS,CAACkC,MAAM,CAACC,QAAQ,OAAAC,eAAA,OACxC,CAAAD,QAAQ,CAAChB,IAAI,CAACkB,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACN,KAAK,CAACK,WAAW,CAAC,CAAC,CAAC,IAAAD,eAAA,CACzDD,QAAQ,CAACf,KAAK,UAAAgB,eAAA,iBAAdA,eAAA,CAAgBE,QAAQ,CAACN,KAAK,CAAC,GACjC,CAAC,CACD7B,oBAAoB,CAAC8B,QAAQ,CAAC,CAChC,CAAC,CAED,KAAM,CAAAM,cAAc,CAAIJ,QAAQ,EAAK,CACnC9B,mBAAmB,CAAC8B,QAAQ,CAAC,CAC7BpC,uBAAuB,CAAC,KAAK,CAAC,CAChC,CAAC,CAED,KAAM,CAAAyC,qBAAqB,CAAGA,CAAA,GAAM,CAClCnC,mBAAmB,CAAC,IAAI,CAAC,CACzBK,QAAQ,CAAC,aAAa,CAAE,IAAI,CAAC,CAC7BA,QAAQ,CAAC,eAAe,CAAE,EAAE,CAAC,CAC7BA,QAAQ,CAAC,gBAAgB,CAAE,EAAE,CAAC,CAChC,CAAC,CAED,KAAM,CAAAM,aAAa,CAAG,KAAAA,CAAA,GAAY,CAChC,GAAI,CACFrB,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAA8B,QAAQ,CAAG,KAAM,CAAAnE,WAAW,CAACoE,MAAM,CAAC,CAAC,CAC3C,GAAID,QAAQ,CAACE,IAAI,CAACC,OAAO,CAAE,CACzBvC,WAAW,CAACoC,QAAQ,CAACE,IAAI,CAACA,IAAI,EAAI,EAAE,CAAC,CACrCpC,mBAAmB,CAACkC,QAAQ,CAACE,IAAI,CAACA,IAAI,EAAI,EAAE,CAAC,CAC/C,CAAC,IAAM,CACLtC,WAAW,CAAC,EAAE,CAAC,CACfyC,OAAO,CAACD,KAAK,CAAC,qBAAqB,CAAEJ,QAAQ,CAACE,IAAI,CAAC5F,OAAO,CAAC,CAC7D,CACF,CAAE,MAAO8F,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,CAAEA,KAAK,CAAC,CAChDxC,WAAW,CAAC,EAAE,CAAC,CACf;AACF,CAAC,OAAS,CACRM,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAA8C,YAAY,CAAIT,KAAK,EAAK,CAC9B,KAAM,CAAAC,QAAQ,CAAG7C,QAAQ,CAAC8C,MAAM,CAACQ,OAAO,OAAAC,YAAA,CAAAC,gBAAA,OACtC,CAAAF,OAAO,CAACvB,IAAI,CAACkB,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACN,KAAK,CAACK,WAAW,CAAC,CAAC,CAAC,IAAAM,YAAA,CACxDD,OAAO,CAACG,GAAG,UAAAF,YAAA,iBAAXA,YAAA,CAAaN,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACN,KAAK,CAACK,WAAW,CAAC,CAAC,CAAC,KAAAO,gBAAA,CACxDF,OAAO,CAACI,OAAO,UAAAF,gBAAA,iBAAfA,gBAAA,CAAiBP,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACN,KAAK,CAACK,WAAW,CAAC,CAAC,CAAC,GAC9D,CAAC,CACD9C,mBAAmB,CAAC0C,QAAQ,CAAC,CAC/B,CAAC,CAED,KAAM,CAAAc,SAAS,CAAIL,OAAO,EAAK,CAC7B,GAAIA,OAAO,CAACM,QAAQ,EAAI,CAAC,CAAE,CACzB5F,KAAK,CAAC6F,OAAO,CAAC,sBAAsB,CAAC,CACrC,OACF,CAEA,KAAM,CAAAC,YAAY,CAAG1D,IAAI,CAAC2D,IAAI,CAACC,IAAI,EAAIA,IAAI,CAACC,UAAU,GAAKX,OAAO,CAACxB,EAAE,CAAC,CAEtE,GAAIgC,YAAY,CAAE,CAChB,GAAIA,YAAY,CAACF,QAAQ,EAAIN,OAAO,CAACM,QAAQ,CAAE,CAC7C5F,KAAK,CAAC6F,OAAO,CAAC,2CAA2C,CAAC,CAC1D,OACF,CACAxD,OAAO,CAACD,IAAI,CAAC8D,GAAG,CAACF,IAAI,EACnBA,IAAI,CAACC,UAAU,GAAKX,OAAO,CAACxB,EAAE,CAAAqC,aAAA,CAAAA,aAAA,IACrBH,IAAI,MAAEJ,QAAQ,CAAEI,IAAI,CAACJ,QAAQ,CAAG,CAAC,GACtCI,IACN,CAAC,CAAC,CACJ,CAAC,IAAM,CACL3D,OAAO,CAAC,CAAC,GAAGD,IAAI,CAAE,CAChB6D,UAAU,CAAEX,OAAO,CAACxB,EAAE,CACtBC,IAAI,CAAEuB,OAAO,CAACvB,IAAI,CAClBqC,KAAK,CAAEd,OAAO,CAACc,KAAK,CACpBR,QAAQ,CAAE,CAAC,CACXS,YAAY,CAAEf,OAAO,CAACM,QACxB,CAAC,CAAC,CAAC,CACL,CACF,CAAC,CAED,KAAM,CAAAU,kBAAkB,CAAGA,CAACL,UAAU,CAAEM,WAAW,GAAK,CACtD,GAAIA,WAAW,EAAI,CAAC,CAAE,CACpBC,cAAc,CAACP,UAAU,CAAC,CAC1B,OACF,CAEA,KAAM,CAAAX,OAAO,CAAGtD,QAAQ,CAAC+D,IAAI,CAACU,CAAC,EAAIA,CAAC,CAAC3C,EAAE,GAAKmC,UAAU,CAAC,CACvD,GAAIM,WAAW,CAAGjB,OAAO,CAACM,QAAQ,CAAE,CAClC5F,KAAK,CAAC6F,OAAO,CAAC,2BAA2B,CAAC,CAC1C,OACF,CAEAxD,OAAO,CAACD,IAAI,CAAC8D,GAAG,CAACF,IAAI,EACnBA,IAAI,CAACC,UAAU,GAAKA,UAAU,CAAAE,aAAA,CAAAA,aAAA,IACrBH,IAAI,MAAEJ,QAAQ,CAAEW,WAAW,GAChCP,IACN,CAAC,CAAC,CACJ,CAAC,CAED,KAAM,CAAAQ,cAAc,CAAIP,UAAU,EAAK,CACrC5D,OAAO,CAACD,IAAI,CAAC0C,MAAM,CAACkB,IAAI,EAAIA,IAAI,CAACC,UAAU,GAAKA,UAAU,CAAC,CAAC,CAC9D,CAAC,CAED,KAAM,CAAAS,SAAS,CAAGA,CAAA,GAAM,CACtBrE,OAAO,CAAC,EAAE,CAAC,CACb,CAAC,CAED,KAAM,CAAAsE,cAAc,CAAGA,CAAA,GAAM,CAC3B,MAAO,CAAAvE,IAAI,CAACwE,MAAM,CAAC,CAACC,KAAK,CAAEb,IAAI,GAAKa,KAAK,CAAIb,IAAI,CAACI,KAAK,CAAGJ,IAAI,CAACJ,QAAS,CAAE,CAAC,CAAC,CAC9E,CAAC,CAED,KAAM,CAAAkB,aAAa,CAAGA,CAAA,GAAM,CAC1B,MAAO,CAAA1E,IAAI,CAACwE,MAAM,CAAC,CAACC,KAAK,CAAEb,IAAI,GAAKa,KAAK,CAAGb,IAAI,CAACJ,QAAQ,CAAE,CAAC,CAAC,CAC/D,CAAC,CAED,KAAM,CAAAmB,cAAc,CAAGA,CAAA,GAAM,CAC3B,GAAI3E,IAAI,CAAC+B,MAAM,GAAK,CAAC,CAAE,CACrBnE,KAAK,CAAC6F,OAAO,CAAC,gBAAgB,CAAC,CAC/B,OACF,CACApD,oBAAoB,CAAC,IAAI,CAAC,CAC5B,CAAC,CAED,KAAM,CAAAuE,WAAW,CAAG,KAAO,CAAAC,MAAM,EAAK,CACpC,GAAI,CACF1E,UAAU,CAAC,IAAI,CAAC,CAEhB,KAAM,CAAA2E,SAAS,CAAG,CAChB3F,aAAa,CAAE0F,MAAM,CAAC1F,aAAa,CACnCG,cAAc,CAAEuF,MAAM,CAACvF,cAAc,CACrCyF,KAAK,CAAE/E,IAAI,CAAC8D,GAAG,CAACF,IAAI,GAAK,CACvBC,UAAU,CAAED,IAAI,CAACC,UAAU,CAC3BmB,YAAY,CAAEpB,IAAI,CAACjC,IAAI,CACvB6B,QAAQ,CAAEI,IAAI,CAACJ,QAAQ,CACvByB,UAAU,CAAErB,IAAI,CAACI,KAAK,CACtBkB,WAAW,CAAEtB,IAAI,CAACI,KAAK,CAAGJ,IAAI,CAACJ,QACjC,CAAC,CAAC,CAAC,CACH2B,YAAY,CAAEZ,cAAc,CAAC,CAAC,CAC9B7E,KAAK,CAAEmF,MAAM,CAACnF,KAChB,CAAC,CAED,KAAM,CAAAuC,QAAQ,CAAG,KAAM,CAAAlE,SAAS,CAACqH,MAAM,CAACN,SAAS,CAAC,CAElD,GAAI7C,QAAQ,CAACE,IAAI,CAACC,OAAO,CAAE,CACzBxE,KAAK,CAACwE,OAAO,CAAC,0BAA0B,CAAC,CAEzChB,KAAK,CAAC,CAAC,CACPP,mBAAmB,CAAC,IAAI,CAAC,CACzByD,SAAS,CAAC,CAAC,CACXjE,oBAAoB,CAAC,KAAK,CAAC,CAE3BmB,aAAa,CAAC,CAAC,CAEf6D,cAAc,CAACpD,QAAQ,CAACE,IAAI,CAACA,IAAI,CAAC,CACpC,CAAC,IAAM,CACLvE,KAAK,CAACyE,KAAK,CAACJ,QAAQ,CAACE,IAAI,CAAC5F,OAAO,EAAI,sBAAsB,CAAC,CAC9D,CACF,CAAE,MAAO8F,KAAK,CAAE,KAAAiD,eAAA,CAAAC,oBAAA,CACd,KAAM,CAAAC,YAAY,CAAG,EAAAF,eAAA,CAAAjD,KAAK,CAACJ,QAAQ,UAAAqD,eAAA,kBAAAC,oBAAA,CAAdD,eAAA,CAAgBnD,IAAI,UAAAoD,oBAAA,iBAApBA,oBAAA,CAAsBhJ,OAAO,GAAI,+BAA+B,CACrFqB,KAAK,CAACyE,KAAK,CAACmD,YAAY,CAAC,CAC3B,CAAC,OAAS,CACRrF,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAAkF,cAAc,CAAII,KAAK,EAAK,KAAAC,eAAA,CAAAC,gBAAA,CAAAC,gBAAA,CAChC,GAAI,CAAAC,aAAa,CAAG,IAAI,CACxB,GAAI,CAAAC,cAAc,CAAG,IAAI,CACzBD,aAAa,CAAGrJ,KAAK,CAACuJ,IAAI,CAAC,CACzBC,KAAK,CAAE,kBAAkB,CACzBC,KAAK,CAAE,GAAG,CACVC,OAAO,cACL7H,KAAA,QAAK8H,KAAK,CAAE,CAAEC,OAAO,CAAE,QAAS,CAAE,CAAAC,QAAA,eAChChI,KAAA,QAAK8H,KAAK,CAAE,CAAEG,SAAS,CAAE,QAAQ,CAAEC,YAAY,CAAE,MAAO,CAAE,CAAAF,QAAA,eACxDlI,IAAA,CAACK,KAAK,EAACgI,KAAK,CAAE,CAAE,CAAAH,QAAA,CAAC,qCAAgB,CAAO,CAAC,cACzChI,KAAA,CAACI,IAAI,EAAA4H,QAAA,EAAC,gCAAY,CAACZ,KAAK,CAACgB,YAAY,EAAO,CAAC,cAAAtI,IAAA,QAAI,CAAC,cAClDA,IAAA,CAACM,IAAI,EAACiI,IAAI,CAAC,WAAW,CAAAL,QAAA,CACnB,GAAI,CAAAM,IAAI,CAAClB,KAAK,CAACmB,UAAU,CAAC,CAACC,cAAc,CAAC,OAAO,CAAC,CAC/C,CAAC,EACJ,CAAC,cACN1I,IAAA,CAACtB,OAAO,GAAE,CAAC,cACXwB,KAAA,QAAK8H,KAAK,CAAE,CAAEI,YAAY,CAAE,MAAO,CAAE,CAAAF,QAAA,eACnClI,IAAA,CAACM,IAAI,EAACqI,MAAM,MAAAT,QAAA,CAAC,oBAAY,CAAM,CAAC,cAChClI,IAAA,CAACM,IAAI,EAAA4H,QAAA,CAAE,EAAAX,eAAA,CAAAD,KAAK,CAAC9C,QAAQ,UAAA+C,eAAA,iBAAdA,eAAA,CAAgB/D,IAAI,GAAI8D,KAAK,CAACtG,aAAa,CAAO,CAAC,cAAAhB,IAAA,QAAI,CAAC,CAC9D,CAAC,EAAAwH,gBAAA,CAAAF,KAAK,CAAC9C,QAAQ,UAAAgD,gBAAA,iBAAdA,gBAAA,CAAgB/D,KAAK,GAAI6D,KAAK,CAACnG,cAAc,gBAC7CjB,KAAA,CAAAE,SAAA,EAAA8H,QAAA,eACElI,IAAA,CAACM,IAAI,EAACqI,MAAM,MAAAT,QAAA,CAAC,qCAAe,CAAM,CAAC,cACnClI,IAAA,CAACM,IAAI,EAAA4H,QAAA,CAAE,EAAAT,gBAAA,CAAAH,KAAK,CAAC9C,QAAQ,UAAAiD,gBAAA,iBAAdA,gBAAA,CAAgBhE,KAAK,GAAI6D,KAAK,CAACnG,cAAc,CAAO,CAAC,EAC5D,CACH,EACE,CAAC,cACNnB,IAAA,CAACtB,OAAO,GAAE,CAAC,cACXsB,IAAA,CAAC9B,IAAI,EACH0K,IAAI,CAAC,OAAO,CACZC,UAAU,CAAEvB,KAAK,CAACV,KAAM,CACxBkC,UAAU,CAAErD,IAAI,eACdzF,IAAA,CAAC9B,IAAI,CAAC6K,IAAI,EAACf,KAAK,CAAE,CAAEC,OAAO,CAAE,OAAQ,CAAE,CAAAC,QAAA,cACrChI,KAAA,QAAK8H,KAAK,CAAE,CAAEF,KAAK,CAAE,MAAM,CAAEkB,OAAO,CAAE,MAAM,CAAEC,cAAc,CAAE,eAAgB,CAAE,CAAAf,QAAA,eAC9EhI,KAAA,QAAAgI,QAAA,eACElI,IAAA,CAACM,IAAI,EAAA4H,QAAA,CAAEzC,IAAI,CAACoB,YAAY,CAAO,CAAC,cAAA7G,IAAA,QAAI,CAAC,cACrCE,KAAA,CAACI,IAAI,EAACiI,IAAI,CAAC,WAAW,CAAAL,QAAA,EAAEzC,IAAI,CAACJ,QAAQ,CAAC,KAAG,CAACvF,cAAc,CAAC2F,IAAI,CAACI,KAAK,CAAC,EAAO,CAAC,EACzE,CAAC,cACN7F,IAAA,CAACM,IAAI,EAACqI,MAAM,MAAAT,QAAA,CAAEpI,cAAc,CAAC2F,IAAI,CAACyD,QAAQ,CAAC,CAAO,CAAC,EAChD,CAAC,CACG,CACX,CACH,CAAC,cACFlJ,IAAA,CAACtB,OAAO,GAAE,CAAC,cACXsB,IAAA,QAAKgI,KAAK,CAAE,CAAEG,SAAS,CAAE,OAAQ,CAAE,CAAAD,QAAA,cACjChI,KAAA,CAACG,KAAK,EAACgI,KAAK,CAAE,CAAE,CAACL,KAAK,CAAE,CAAEmB,MAAM,CAAE,CAAE,CAAE,CAAAjB,QAAA,EAAC,uBAC1B,CAACpI,cAAc,CAACwH,KAAK,CAACN,YAAY,CAAC,EACzC,CAAC,CACL,CAAC,EACH,CACN,CACDoC,MAAM,CAAE,cACNpJ,IAAA,CAAC/B,MAAM,EAELsK,IAAI,CAAC,SAAS,CACdc,IAAI,cAAErJ,IAAA,CAACf,eAAe,GAAE,CAAE,CAC1BqK,OAAO,CAAEA,CAAA,GAAMC,MAAM,CAACC,KAAK,CAAC,CAAE,CAAAtB,QAAA,CAC/B,yBAED,EANM,OAME,CAAC,cACTlI,IAAA,CAAC/B,MAAM,EAELqL,OAAO,CAAEA,CAAA,GAAM,CAAE,GAAI5B,aAAa,CAAEA,aAAa,CAAC+B,OAAO,CAAC,CAAC,CAAE,GAAI9B,cAAc,CAAE+B,YAAY,CAAC/B,cAAc,CAAC,CAAE,CAAE,CAAAO,QAAA,CAClH,cAED,EAJM,OAIE,CAAC,CAEb,CAAC,CAAC,CACFP,cAAc,CAAGgC,UAAU,CAAC,IAAM,CAChC,GAAIjC,aAAa,CAAEA,aAAa,CAAC+B,OAAO,CAAC,CAAC,CAC5C,CAAC,CAAE,IAAI,CAAC,CACV,CAAC,CAED,KAAM,CAAAG,eAAe,CAAG,CACtB,CACE/B,KAAK,CAAE,gBAAgB,CACvBgC,SAAS,CAAE,MAAM,CACjBC,GAAG,CAAE,MACP,CAAC,CACD,CACEjC,KAAK,CAAE,eAAe,CACtBgC,SAAS,CAAE,OAAO,CAClBC,GAAG,CAAE,OACP,CAAC,CACD,CACEjC,KAAK,CAAE,OAAO,CACdgC,SAAS,CAAE,OAAO,CAClBC,GAAG,CAAE,OACP,CAAC,CACD,CACEjC,KAAK,CAAE,SAAS,CAChBgC,SAAS,CAAE,SAAS,CACpBC,GAAG,CAAE,SACP,CAAC,CACD,CACEjC,KAAK,CAAE,WAAW,CAClBiC,GAAG,CAAE,QAAQ,CACbC,MAAM,CAAEA,CAACC,CAAC,CAAEC,MAAM,gBAChBjK,IAAA,CAAC/B,MAAM,EAACsK,IAAI,CAAC,MAAM,CAACe,OAAO,CAAEA,CAAA,GAAM1E,cAAc,CAACqF,MAAM,CAAE,CAAA/B,QAAA,CAAC,WAAI,CAAQ,CAE3E,CAAC,CACF,CAED,mBACEhI,KAAA,QAAKgK,SAAS,CAAC,UAAU,CAAAhC,QAAA,eACvBhI,KAAA,CAACrC,GAAG,EAACsM,MAAM,CAAE,CAAC,EAAE,CAAE,EAAE,CAAE,CAAAjC,QAAA,eACpBlI,IAAA,CAAClC,GAAG,EAACsM,EAAE,CAAE,EAAG,CAACC,EAAE,CAAE,EAAG,CAAAnC,QAAA,cAClBlI,IAAA,CAACjC,IAAI,EACH8J,KAAK,CAAC,iCAAoB,CAC1ByC,KAAK,cACHtK,IAAA,CAACO,MAAM,EACLgK,WAAW,CAAC,8BAAiB,CAC7BC,QAAQ,CAAE1F,YAAa,CACvBkD,KAAK,CAAE,CAAEF,KAAK,CAAE,GAAI,CAAE,CACtB/F,OAAO,CAAEA,OAAQ,CAClB,CACF,CAAAmG,QAAA,CAEAnG,OAAO,cACN/B,IAAA,QAAKgI,KAAK,CAAE,CAAEG,SAAS,CAAE,QAAQ,CAAEF,OAAO,CAAE,MAAO,CAAE,CAAAC,QAAA,cACnDlI,IAAA,CAACrB,IAAI,EAACiK,IAAI,CAAC,OAAO,CAAE,CAAC,CAClB,CAAC,cAEN5I,IAAA,CAAC9B,IAAI,EACHuM,IAAI,CAAE,CAAEN,MAAM,CAAE,EAAE,CAAEC,EAAE,CAAE,CAAC,CAAEM,EAAE,CAAE,CAAC,CAAEC,EAAE,CAAE,CAAC,CAAEN,EAAE,CAAE,CAAC,CAAEO,EAAE,CAAE,CAAC,CAAEC,GAAG,CAAE,CAAE,CAAE,CAChEhC,UAAU,CAAElH,gBAAiB,CAC7BmH,UAAU,CAAE/D,OAAO,eACjB/E,IAAA,CAAC9B,IAAI,CAAC6K,IAAI,EAAAb,QAAA,cACRhI,KAAA,CAACnC,IAAI,EACH+M,SAAS,MACTC,KAAK,cAAE/K,IAAA,QAAKgL,GAAG,CAAEjG,OAAO,CAACvB,IAAK,CAACyH,GAAG,CAAElG,OAAO,CAACmG,SAAS,EAAI,iCAAkC,CAAE,CAAE,CAC/F5B,OAAO,CAAEA,CAAA,GAAMlE,SAAS,CAACL,OAAO,CAAE,CAClCiD,KAAK,CAAE,CAAEmD,MAAM,CAAE,MAAM,CAAEnC,OAAO,CAAE,MAAM,CAAEoC,aAAa,CAAE,QAAQ,CAAEnC,cAAc,CAAE,eAAgB,CAAE,CAAAf,QAAA,eAErGlI,IAAA,CAACjC,IAAI,CAACsN,IAAI,EACRxD,KAAK,CAAE9C,OAAO,CAACvB,IAAK,CACpB8H,WAAW,CAAExL,cAAc,CAACiF,OAAO,CAACc,KAAK,CAAE,CAC5C,CAAC,cACF3F,KAAA,QAAK8H,KAAK,CAAE,CAAEuD,SAAS,CAAE,MAAO,CAAE,CAAArD,QAAA,eAChChI,KAAA,CAACI,IAAI,EAACiI,IAAI,CAAC,WAAW,CAAAL,QAAA,EAAC,gBAAS,CAACnD,OAAO,CAACM,QAAQ,EAAO,CAAC,CACxDN,OAAO,CAACM,QAAQ,EAAI,EAAE,EAAIN,OAAO,CAACM,QAAQ,CAAG,CAAC,eAC7CrF,IAAA,CAACvB,GAAG,EAAC+M,KAAK,CAAC,SAAS,CAACxD,KAAK,CAAE,CAAEyD,UAAU,CAAE,KAAM,CAAE,CAAAvD,QAAA,CAAC,mBAAO,CAAK,CAChE,CACAnD,OAAO,CAACM,QAAQ,GAAK,CAAC,eACrBrF,IAAA,CAACvB,GAAG,EAAC+M,KAAK,CAAC,OAAO,CAACxD,KAAK,CAAE,CAAEyD,UAAU,CAAE,KAAM,CAAE,CAAAvD,QAAA,CAAC,kBAAQ,CAAK,CAC/D,EACE,CAAC,EACF,CAAC,CACE,CACX,CACH,CACF,CACG,CAAC,CACJ,CAAC,cAENlI,IAAA,CAAClC,GAAG,EAACsM,EAAE,CAAE,EAAG,CAACC,EAAE,CAAE,CAAE,CAAAnC,QAAA,cACjBhI,KAAA,CAACnC,IAAI,EACH8J,KAAK,CAAC,kBAAU,CAChB6D,OAAO,CAAE,cACPxL,KAAA,CAACjC,MAAM,EACLsK,IAAI,CAAC,SAAS,CACdc,IAAI,cAAErJ,IAAA,CAAChB,oBAAoB,GAAE,CAAE,CAC/BsK,OAAO,CAAE9C,cAAe,CACxBmF,QAAQ,CAAE9J,IAAI,CAAC+B,MAAM,GAAK,CAAE,CAAAsE,QAAA,EAC7B,iBACa,CAAC3B,aAAa,CAAC,CAAC,CAAC,GAC/B,EAAQ,CAAC,cACTvG,IAAA,CAAC/B,MAAM,EACL2N,MAAM,MACNvC,IAAI,cAAErJ,IAAA,CAACjB,cAAc,GAAE,CAAE,CACzBuK,OAAO,CAAEnD,SAAU,CACnBwF,QAAQ,CAAE9J,IAAI,CAAC+B,MAAM,GAAK,CAAE,CAAAsE,QAAA,CAC7B,yBAED,CAAQ,CAAC,CACT,CAAAA,QAAA,eAEFlI,IAAA,CAAC9B,IAAI,EACH2N,UAAU,CAAC,YAAY,CACvBhD,UAAU,CAAEhH,IAAK,CACjBiH,UAAU,CAAErD,IAAI,eACdvF,KAAA,CAAChC,IAAI,CAAC6K,IAAI,EACR2C,OAAO,CAAE,cACP1L,IAAA,CAAC/B,MAAM,EACLoL,IAAI,cAAErJ,IAAA,CAACnB,YAAY,GAAE,CAAE,CACvByK,OAAO,CAAEA,CAAA,GAAMvD,kBAAkB,CAACN,IAAI,CAACC,UAAU,CAAED,IAAI,CAACJ,QAAQ,CAAG,CAAC,CAAE,CACtEsG,QAAQ,CAAElG,IAAI,CAACJ,QAAQ,EAAII,IAAI,CAACK,YAAa,CAC9C,CAAC,cACF9F,IAAA,CAACzB,WAAW,EACV2C,GAAG,CAAE,CAAE,CACP4K,GAAG,CAAErG,IAAI,CAACK,YAAa,CACvBzB,KAAK,CAAEoB,IAAI,CAACJ,QAAS,CACrB0G,QAAQ,CAAG1H,KAAK,EAAK0B,kBAAkB,CAACN,IAAI,CAACC,UAAU,CAAErB,KAAK,CAAE,CAChE2D,KAAK,CAAE,CAAEF,KAAK,CAAE,EAAG,CAAE,CACtB,CAAC,cACF9H,IAAA,CAAC/B,MAAM,EACLoL,IAAI,cAAErJ,IAAA,CAAClB,aAAa,GAAE,CAAE,CACxBwK,OAAO,CAAEA,CAAA,GAAMvD,kBAAkB,CAACN,IAAI,CAACC,UAAU,CAAED,IAAI,CAACJ,QAAQ,CAAG,CAAC,CAAE,CACvE,CAAC,cACFrF,IAAA,CAAC/B,MAAM,EACLsK,IAAI,CAAC,MAAM,CACXc,IAAI,cAAErJ,IAAA,CAACjB,cAAc,EAACiJ,KAAK,CAAE,CAAEwD,KAAK,CAAE,KAAM,CAAE,CAAE,CAAE,CAClDlC,OAAO,CAAEA,CAAA,GAAMrD,cAAc,CAACR,IAAI,CAACC,UAAU,CAAE,CAChD,CAAC,CACF,CAAAwC,QAAA,eAEFlI,IAAA,CAAC9B,IAAI,CAAC6K,IAAI,CAACsC,IAAI,EACbxD,KAAK,CAAEpC,IAAI,CAACjC,IAAK,CACjB8H,WAAW,CAAExL,cAAc,CAAC2F,IAAI,CAACI,KAAK,CAAE,CACzC,CAAC,cACF7F,IAAA,QAAAkI,QAAA,cACElI,IAAA,CAACM,IAAI,EAACqI,MAAM,MAAAT,QAAA,CAAEpI,cAAc,CAAC2F,IAAI,CAACI,KAAK,CAAGJ,IAAI,CAACJ,QAAQ,CAAC,CAAO,CAAC,CAC7D,CAAC,EACG,CACX,CACH,CAAC,cACFrF,IAAA,CAACtB,OAAO,GAAE,CAAC,cACXsB,IAAA,QAAKgI,KAAK,CAAE,CAAEG,SAAS,CAAE,OAAQ,CAAE,CAAAD,QAAA,cACjChI,KAAA,CAACG,KAAK,EAACgI,KAAK,CAAE,CAAE,CAAAH,QAAA,EAAC,uBAAW,CAACpI,cAAc,CAACsG,cAAc,CAAC,CAAC,CAAC,EAAQ,CAAC,CACnE,CAAC,EACF,CAAC,CACJ,CAAC,EACH,CAAC,cAENpG,IAAA,CAAC3B,KAAK,EACJwJ,KAAK,CAAC,gCAAc,CACpBmE,OAAO,CAAE/J,iBAAkB,CAC3BgK,QAAQ,CAAEA,CAAA,GAAM/J,oBAAoB,CAAC,KAAK,CAAE,CAC5CkH,MAAM,CAAE,IAAK,CACbtB,KAAK,CAAE,GAAI,CAAAI,QAAA,cAEXhI,KAAA,CAAC5B,IAAI,EAAC4N,MAAM,CAAC,UAAU,CAACC,QAAQ,CAAEvJ,YAAY,CAAC6D,WAAW,CAAE,CAAAyB,QAAA,eAC1DlI,IAAA,CAAC1B,IAAI,CAACyK,IAAI,EAACqD,KAAK,CAAC,kBAAY,CAAAlE,QAAA,CAC1BzF,gBAAgB,cACfvC,KAAA,CAAC1B,KAAK,EAAA0J,QAAA,eACJlI,IAAA,CAACM,IAAI,EAACqI,MAAM,MAAAT,QAAA,CAAEzF,gBAAgB,CAACe,IAAI,CAAO,CAAC,cAC3CtD,KAAA,CAACI,IAAI,EAACiI,IAAI,CAAC,WAAW,CAAAL,QAAA,EAAC,GAAC,CAACzF,gBAAgB,CAACgB,KAAK,CAAC,GAAC,EAAM,CAAC,cACxDzD,IAAA,CAAC/B,MAAM,EAAC2K,IAAI,CAAC,OAAO,CAACU,OAAO,CAAEzE,qBAAsB,CAAAqD,QAAA,CAAC,QAAG,CAAQ,CAAC,EAC5D,CAAC,cAERlI,IAAA,CAAC/B,MAAM,EACLoL,IAAI,cAAErJ,IAAA,CAACZ,YAAY,GAAE,CAAE,CACvBkK,OAAO,CAAEA,CAAA,GAAMlH,uBAAuB,CAAC,IAAI,CAAE,CAAA8F,QAAA,CAC9C,4BAED,CAAQ,CACT,CACQ,CAAC,CAEX,CAACzF,gBAAgB,eAChBzC,IAAA,CAACV,UAAU,EACTkE,IAAI,CAAC,gBAAgB,CACrBb,OAAO,CAAEA,OAAQ,CACjBoH,MAAM,CAAEsC,IAAA,OAAAC,qBAAA,IAAC,CAAEC,KAAM,CAAC,CAAAF,IAAA,oBAChBrM,IAAA,CAAC1B,IAAI,CAACyK,IAAI,EAACqD,KAAK,CAAC,oDAA0B,CAACI,IAAI,EAAAF,qBAAA,CAAExJ,MAAM,CAAC3B,cAAc,UAAAmL,qBAAA,iBAArBA,qBAAA,CAAuBlO,OAAQ,CAACqO,cAAc,CAAE3J,MAAM,CAAC3B,cAAc,CAAG,OAAO,CAAG,EAAG,CAAA+G,QAAA,cACrIlI,IAAA,CAACO,MAAM,CAAAqF,aAAA,CAAAA,aAAA,IACD2G,KAAK,MACThJ,EAAE,CAAC,gBAAgB,CACnBC,IAAI,CAAC,gBAAgB,CACrB+G,WAAW,CAAC,oEAAuC,CACnDC,QAAQ,CAAGnG,KAAK,EAAK,CACnB,KAAM,CAAAqI,aAAa,CAAGrK,SAAS,CAACmD,IAAI,CAACmH,CAAC,EAAIA,CAAC,CAAClJ,KAAK,GAAKY,KAAK,CAAC,CAC5D,GAAIqI,aAAa,CAAE,CACjB9H,cAAc,CAAC8H,aAAa,CAAC,CAC7BjN,KAAK,CAACwE,OAAO,kDAAA2I,MAAA,CAA4BF,aAAa,CAAClJ,IAAI,CAAE,CAAC,CAChE,CAAC,IAAM,IAAIa,KAAK,CAAE,CAChB5E,KAAK,CAACmI,IAAI,CAAC,+DAA+D,CAAC,CAC3E7E,QAAQ,CAAC,eAAe,CAAE,EAAE,CAAC,CAC/B,CACAwJ,KAAK,CAACR,QAAQ,CAAC1H,KAAK,CAAC,CACvB,CAAE,CACFwI,WAAW,cAAE7M,IAAA,CAACd,cAAc,GAAE,CAAE,EACjC,CAAC,CACO,CAAC,EACZ,CACH,CACF,CAEA,CAACuD,gBAAgB,EAAI,CAACW,kBAAkB,eACvCpD,IAAA,CAACV,UAAU,EACTkE,IAAI,CAAC,eAAe,CACpBb,OAAO,CAAEA,OAAQ,CACjBoH,MAAM,CAAE+C,KAAA,OAAAC,qBAAA,IAAC,CAAER,KAAM,CAAC,CAAAO,KAAA,oBAChB9M,IAAA,CAAC1B,IAAI,CAACyK,IAAI,EAACqD,KAAK,CAAC,4DAAmC,CAACI,IAAI,EAAAO,qBAAA,CAAEjK,MAAM,CAAC9B,aAAa,UAAA+L,qBAAA,iBAApBA,qBAAA,CAAsB3O,OAAQ,CAACqO,cAAc,CAAE3J,MAAM,CAAC9B,aAAa,CAAG,OAAO,CAAG,EAAG,CAAAkH,QAAA,cAC5IlI,IAAA,CAAChC,KAAK,CAAA4H,aAAA,CAAAA,aAAA,IAAK2G,KAAK,MAAEhJ,EAAE,CAAC,eAAe,CAACC,IAAI,CAAC,eAAe,CAAC+G,WAAW,CAAC,mCAAqB,EAAE,CAAC,CACrF,CAAC,EACZ,CACH,CACF,cAEDvK,IAAA,CAACV,UAAU,EACTkE,IAAI,CAAC,OAAO,CACZb,OAAO,CAAEA,OAAQ,CACjBoH,MAAM,CAAEiD,KAAA,MAAC,CAAET,KAAM,CAAC,CAAAS,KAAA,oBAChBhN,IAAA,CAAC1B,IAAI,CAACyK,IAAI,EAACqD,KAAK,CAAC,YAAS,CAAAlE,QAAA,cACxBlI,IAAA,CAAChC,KAAK,CAACiP,QAAQ,CAAArH,aAAA,CAAAA,aAAA,IAAK2G,KAAK,MAAEhJ,EAAE,CAAC,OAAO,CAACC,IAAI,CAAC,OAAO,CAAC0J,IAAI,CAAE,CAAE,CAAC3C,WAAW,CAAC,0CAAqB,EAAE,CAAC,CACvF,CAAC,EACZ,CACH,CAAC,cAEFvK,IAAA,CAACtB,OAAO,GAAE,CAAC,cAEXsB,IAAA,QAAKgI,KAAK,CAAE,CAAEG,SAAS,CAAE,OAAO,CAAEC,YAAY,CAAE,MAAO,CAAE,CAAAF,QAAA,cACvDhI,KAAA,CAACG,KAAK,EAACgI,KAAK,CAAE,CAAE,CAAAH,QAAA,EAAC,uBAAW,CAACpI,cAAc,CAACsG,cAAc,CAAC,CAAC,CAAC,EAAQ,CAAC,CACnE,CAAC,cAENpG,IAAA,CAAC1B,IAAI,CAACyK,IAAI,EAAAb,QAAA,cACRlI,IAAA,CAAC/B,MAAM,EAACsK,IAAI,CAAC,SAAS,CAAC4E,QAAQ,CAAC,QAAQ,CAACC,KAAK,MAACrL,OAAO,CAAEA,OAAQ,CAAAmG,QAAA,CAAC,wCAEjE,CAAQ,CAAC,CACA,CAAC,EACR,CAAC,CACF,CAAC,cAERhI,KAAA,CAAC7B,KAAK,EACJwJ,KAAK,CAAC,4BAAiB,CACvBmE,OAAO,CAAE7J,oBAAqB,CAC9B8J,QAAQ,CAAEA,CAAA,GAAM7J,uBAAuB,CAAC,KAAK,CAAE,CAC/CgH,MAAM,CAAE,IAAK,CACbtB,KAAK,CAAE,GAAI,CAAAI,QAAA,eAEXlI,IAAA,CAACO,MAAM,EACLgK,WAAW,CAAC,oFAA+C,CAC3DC,QAAQ,CAAEpG,oBAAqB,CAC/B4D,KAAK,CAAE,CAAEI,YAAY,CAAE,EAAG,CAAE,CAC7B,CAAC,cACFpI,IAAA,CAACpB,KAAK,EACJiK,UAAU,CAAEtG,iBAAkB,CAC9B8K,OAAO,CAAEzD,eAAgB,CACzB0D,MAAM,CAAC,IAAI,CACXC,UAAU,CAAE,CAAEC,QAAQ,CAAE,CAAE,CAAE,CAC5BC,MAAM,CAAE,CAAEC,CAAC,CAAE,GAAI,CAAE,CACpB,CAAC,EACG,CAAC,cACR1N,IAAA,CAACN,cAAc,EAACiO,QAAQ,CAAC,cAAc,CAACC,SAAS,CAAE,IAAK,CAACC,eAAe,CAAE,KAAM,CAACC,WAAW,CAAE,KAAM,CAACC,YAAY,MAACC,GAAG,CAAE,KAAM,CAACC,gBAAgB,MAACC,SAAS,MAACC,YAAY,MAAE,CAAC,EACrK,CAAC,CAEV,CAEA,cAAe,CAAA3M,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}