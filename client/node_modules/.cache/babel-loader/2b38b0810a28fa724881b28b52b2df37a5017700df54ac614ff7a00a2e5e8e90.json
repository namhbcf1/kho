{"ast":null,"code":"import _objectSpread from\"C:/Users/ADMIN/Desktop/kho/kho/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Row,Col,Card,Input,Button,List,Typography,message,Modal,Form,InputNumber,Space,Tag,Divider,Spin,Table,Radio}from'antd';import{PlusOutlined,MinusOutlined,DeleteOutlined,ShoppingCartOutlined,PrinterOutlined,SearchOutlined,ShoppingOutlined,UserOutlined}from'@ant-design/icons';import{useForm,Controller}from'react-hook-form';import{zodResolver}from'@hookform/resolvers/zod';import*as z from'zod';import{toast,ToastContainer}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import{productsAPI,ordersAPI,customersAPI}from'../services/api';import{formatCurrency}from'../utils/format';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const{Title,Text}=Typography;const{Search}=Input;const orderSchema=z.object({customer_id:z.number().int().positive().optional().nullable(),customer_name:z.string().optional(),customer_phone:z.string().optional(),customer_email:z.string().email('Email không hợp lệ').optional().or(z.literal('')),payment_method:z.enum(['cash','card','transfer','ewallet']).optional(),notes:z.string().optional()});function POSPage(){const[products,setProducts]=useState([]);const[filteredProducts,setFilteredProducts]=useState([]);const[cart,setCart]=useState([]);const[loading,setLoading]=useState(false);const[orderModalVisible,setOrderModalVisible]=useState(false);const[customerModalVisible,setCustomerModalVisible]=useState(false);const[customers,setCustomers]=useState([]);const[filteredCustomers,setFilteredCustomers]=useState([]);const[selectedCustomer,setSelectedCustomer]=useState(null);const[serialModalVisible,setSerialModalVisible]=useState(false);const[selectedProductForSerial,setSelectedProductForSerial]=useState(null);const[availableSerials,setAvailableSerials]=useState([]);const[selectedSerials,setSelectedSerials]=useState([]);const{control,handleSubmit,formState:{errors},setValue,watch,reset}=useForm({resolver:zodResolver(orderSchema),defaultValues:{customer_id:null,customer_name:'',customer_phone:'',customer_email:'',payment_method:'cash',notes:''}});const customerPhoneWatch=watch('customer_phone');useEffect(()=>{fetchProducts();fetchCustomers();},[]);useEffect(()=>{if(selectedCustomer){setValue('customer_id',selectedCustomer.id);setValue('customer_name',selectedCustomer.name);setValue('customer_phone',selectedCustomer.phone);setValue('customer_email',selectedCustomer.email||'');}else{setValue('customer_id',null);}},[selectedCustomer,setValue]);const fetchCustomers=async function(){let searchQuery=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';try{const response=await customersAPI.getAll({phone:searchQuery,name:searchQuery});if(response.data.success){setCustomers(response.data.data||[]);setFilteredCustomers(response.data.data||[]);}else{setCustomers([]);toast.error('Lỗi khi lấy danh sách khách hàng: '+response.data.message);}}catch(error){console.error('Error fetching customers:',error);setCustomers([]);toast.error('Lỗi kết nối khi lấy danh sách khách hàng.');}};const handleCustomerSearch=value=>{const filtered=customers.filter(customer=>{var _customer$phone;return customer.name.toLowerCase().includes(value.toLowerCase())||((_customer$phone=customer.phone)===null||_customer$phone===void 0?void 0:_customer$phone.includes(value));});setFilteredCustomers(filtered);};const selectCustomer=customer=>{setSelectedCustomer(customer);setCustomerModalVisible(false);};const clearSelectedCustomer=()=>{setSelectedCustomer(null);setValue('customer_id',null);setValue('customer_name','');setValue('customer_phone','');setValue('customer_email','');};const fetchProducts=async()=>{try{setLoading(true);const response=await productsAPI.getAll();if(response.data.success){setProducts(response.data.data||[]);setFilteredProducts(response.data.data||[]);}else{setProducts([]);console.error('API returned error:',response.data.message);}}catch(error){console.error('Error fetching products:',error);setProducts([]);// Don't show error message to user, just silently handle it\n}finally{setLoading(false);}};const handleSearch=value=>{const filtered=products.filter(product=>{var _product$sku,_product$barcode;return product.name.toLowerCase().includes(value.toLowerCase())||((_product$sku=product.sku)===null||_product$sku===void 0?void 0:_product$sku.toLowerCase().includes(value.toLowerCase()))||((_product$barcode=product.barcode)===null||_product$barcode===void 0?void 0:_product$barcode.toLowerCase().includes(value.toLowerCase()));});setFilteredProducts(filtered);};const handleSerialSearch=async serialNumber=>{if(!serialNumber.trim()){setFilteredProducts(products);return;}try{setLoading(true);// Tìm kiếm serial trong database\nconst response=await productsAPI.searchSerials({q:serialNumber,status:'available'});if(response.data.success&&response.data.data.length>0){const serial=response.data.data[0];// Tìm sản phẩm tương ứng với serial\nconst product=products.find(p=>p.id===serial.product_id);if(product){// Hiển thị sản phẩm tìm thấy\nsetFilteredProducts([product]);// Tự động thêm serial vào giỏ hàng\nconst existingItem=cart.find(item=>{var _item$serial;return item.product.id===product.id&&((_item$serial=item.serial)===null||_item$serial===void 0?void 0:_item$serial.serial_number)===serial.serial_number;});if(existingItem){message.warning(\"Serial \".concat(serial.serial_number,\" \\u0111\\xE3 c\\xF3 trong gi\\u1ECF h\\xE0ng\"));}else{setCart(prev=>[...prev,{product:product,quantity:1,serial:serial,price:product.price}]);message.success(\"\\u0110\\xE3 th\\xEAm s\\u1EA3n ph\\u1EA9m \".concat(product.name,\" (Serial: \").concat(serial.serial_number,\") v\\xE0o gi\\u1ECF h\\xE0ng\"));}}else{message.error('Không tìm thấy sản phẩm tương ứng với serial này');}}else{message.error('Không tìm thấy serial hoặc serial đã được bán');setFilteredProducts(products);}}catch(error){console.error('Error searching serial:',error);message.error('Lỗi khi tìm kiếm serial');setFilteredProducts(products);}finally{setLoading(false);}};const showSerialModal=async product=>{try{setSelectedProductForSerial(product);const response=await productsAPI.getSerials(product.id,{status:'available'});if(response.data.success){setAvailableSerials(Array.isArray(response.data.data)?response.data.data:[]);}else{setAvailableSerials([]);}setSerialModalVisible(true);}catch(error){console.error('Error fetching serials:',error);setAvailableSerials([]);toast.error('Không thể tải danh sách serial của sản phẩm');}};const addToCart=async product=>{try{// Thay vì thêm trực tiếp vào giỏ hàng, hiển thị modal chọn serial\nawait showSerialModal(product);}catch(error){console.error('Error adding to cart:',error);message.error('Lỗi khi thêm sản phẩm vào giỏ hàng');}};const addSerialToCart=selectedSerials=>{if(!selectedSerials||selectedSerials.length===0){message.warning('Vui lòng chọn ít nhất một serial');return;}selectedSerials.forEach(serial=>{const existingItem=cart.find(item=>{var _item$serial2;return item.product.id===selectedProductForSerial.id&&((_item$serial2=item.serial)===null||_item$serial2===void 0?void 0:_item$serial2.serial_number)===serial.serial_number;});if(existingItem){message.warning(\"Serial \".concat(serial.serial_number,\" \\u0111\\xE3 c\\xF3 trong gi\\u1ECF h\\xE0ng\"));return;}setCart(prev=>[...prev,{product:selectedProductForSerial,quantity:1,serial:serial,price:selectedProductForSerial.price}]);});message.success(\"\\u0110\\xE3 th\\xEAm \".concat(selectedSerials.length,\" s\\u1EA3n ph\\u1EA9m v\\xE0o gi\\u1ECF h\\xE0ng\"));setSerialModalVisible(false);setSelectedSerials([]);};const removeFromCart=(productId,serialNumber)=>{if(serialNumber){// Xóa item có serial cụ thể\nsetCart(prev=>prev.filter(item=>{var _item$serial3;return!(item.product.id===productId&&((_item$serial3=item.serial)===null||_item$serial3===void 0?void 0:_item$serial3.serial_number)===serialNumber);}));}else{// Xóa tất cả item của sản phẩm này (fallback)\nsetCart(prev=>prev.filter(item=>item.product.id!==productId));}};const updateQuantity=(productId,serialNumber,newQuantity)=>{if(newQuantity<=0){removeFromCart(productId,serialNumber);return;}setCart(prev=>prev.map(item=>{var _item$serial4;if(item.product.id===productId&&((_item$serial4=item.serial)===null||_item$serial4===void 0?void 0:_item$serial4.serial_number)===serialNumber){return _objectSpread(_objectSpread({},item),{},{quantity:newQuantity});}return item;}));};const clearCart=()=>{setCart([]);};const getTotalAmount=()=>{return cart.reduce((total,item)=>total+item.price*item.quantity,0);};const getTotalItems=()=>{return cart.reduce((total,item)=>total+item.quantity,0);};const handleCheckout=()=>{if(cart.length===0){toast.warning('Giỏ hàng trống');return;}setOrderModalVisible(true);};const submitOrder=async values=>{setLoading(true);try{// Tổng hợp tất cả serial để bán\nconst serialsToSell=[];cart.forEach(item=>{if(item.serial&&item.serial.serial_number){serialsToSell.push(item.serial.serial_number);}});const orderData={customer_id:(selectedCustomer===null||selectedCustomer===void 0?void 0:selectedCustomer.id)||null,customer_name:(selectedCustomer===null||selectedCustomer===void 0?void 0:selectedCustomer.name)||values.customer_name||null,customer_phone:(selectedCustomer===null||selectedCustomer===void 0?void 0:selectedCustomer.phone)||values.customer_phone||null,customer_email:(selectedCustomer===null||selectedCustomer===void 0?void 0:selectedCustomer.email)||values.customer_email||null,payment_method:values.payment_method||'cash',items:cart.map(item=>{var _item$serial5;return{product_id:item.product.id,product_name:item.product.name,quantity:item.quantity,price:item.price,subtotal:item.quantity*item.price,serial_number:((_item$serial5=item.serial)===null||_item$serial5===void 0?void 0:_item$serial5.serial_number)||null};}),total_amount:getTotalAmount(),serials_sold:serialsToSell,notes:values.notes||null};const response=await ordersAPI.create(orderData);if(response.data.success){// Đánh dấu serial đã bán\nif(serialsToSell.length>0){await productsAPI.sellSerials({serial_numbers:serialsToSell,order_id:response.data.data.id,customer_id:response.data.data.customer_id||(selectedCustomer===null||selectedCustomer===void 0?void 0:selectedCustomer.id)||null,sold_price:getTotalAmount(),notes:\"B\\xE1n qua POS - \".concat(response.data.data.order_number)});}// Refresh customer list to sync with customers page\nawait fetchCustomers();toast.success('Tạo đơn hàng thành công!');setSelectedCustomer(null);clearCart();setOrderModalVisible(false);reset();// Reset form\nfetchProducts();showPrintModal(response.data.data);}else{toast.error(response.data.message||'Lỗi khi tạo đơn hàng');}}catch(error){var _error$response,_error$response$data;const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Lỗi kết nối khi tạo đơn hàng.';toast.error(errorMessage);}finally{setLoading(false);}};const showPrintModal=order=>{var _order$customer,_order$customer2,_order$customer3;let modalInstance=null;let autoCloseTimer=null;modalInstance=Modal.info({title:'Hóa đơn bán hàng',width:600,content:/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px 0'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',marginBottom:'20px'},children:[/*#__PURE__*/_jsx(Title,{level:4,children:\"H\\xD3A \\u0110\\u01A0N B\\xC1N H\\xC0NG\"}),/*#__PURE__*/_jsxs(Text,{children:[\"S\\u1ED1 h\\xF3a \\u0111\\u01A1n: \",order.order_number]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:new Date(order.created_at).toLocaleString('vi-VN')})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px'},children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"Kh\\xE1ch h\\xE0ng: \"}),/*#__PURE__*/_jsx(Text,{children:((_order$customer=order.customer)===null||_order$customer===void 0?void 0:_order$customer.name)||order.customer_name}),/*#__PURE__*/_jsx(\"br\",{}),(((_order$customer2=order.customer)===null||_order$customer2===void 0?void 0:_order$customer2.phone)||order.customer_phone)&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i: \"}),/*#__PURE__*/_jsx(Text,{children:((_order$customer3=order.customer)===null||_order$customer3===void 0?void 0:_order$customer3.phone)||order.customer_phone})]})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(List,{size:\"small\",dataSource:order.items,renderItem:item=>/*#__PURE__*/_jsx(List.Item,{style:{padding:'8px 0'},children:/*#__PURE__*/_jsx(\"div\",{style:{width:'100%'},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Text,{strong:true,children:item.product_name}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[item.quantity,\" x \",formatCurrency(item.price)]}),item.serials&&item.serials.length>0&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:4},children:/*#__PURE__*/_jsxs(Text,{type:\"secondary\",style:{fontSize:'12px'},children:[\"Serial: \",item.serials.join(', ')]})})]}),/*#__PURE__*/_jsx(Text,{strong:true,children:formatCurrency(item.subtotal)})]})})})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'right'},children:/*#__PURE__*/_jsxs(Title,{level:4,style:{margin:0},children:[\"T\\u1ED5ng c\\u1ED9ng: \",formatCurrency(order.total_amount)]})})]}),footer:[/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(PrinterOutlined,{}),onClick:()=>window.print(),children:\"In h\\xF3a \\u0111\\u01A1n\"},\"print\"),/*#__PURE__*/_jsx(Button,{onClick:()=>{if(modalInstance)modalInstance.destroy();if(autoCloseTimer)clearTimeout(autoCloseTimer);},children:\"\\u0110\\xF3ng\"},\"close\")]});autoCloseTimer=setTimeout(()=>{if(modalInstance)modalInstance.destroy();},5000);};const customerColumns=[{title:'Tên khách hàng',dataIndex:'name',key:'name'},{title:'Số điện thoại',dataIndex:'phone',key:'phone'},{title:'Email',dataIndex:'email',key:'email'},{title:'Địa chỉ',dataIndex:'address',key:'address'},{title:'Hành động',key:'action',render:(_,record)=>/*#__PURE__*/_jsx(Button,{type:\"link\",onClick:()=>selectCustomer(record),children:\"Ch\\u1ECDn\"})}];return/*#__PURE__*/_jsxs(\"div\",{className:\"pos-page\",children:[/*#__PURE__*/_jsxs(Row,{gutter:[16,16],children:[/*#__PURE__*/_jsx(Col,{xs:24,lg:16,children:/*#__PURE__*/_jsx(Card,{title:\"Danh s\\xE1ch s\\u1EA3n ph\\u1EA9m\",extra:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",size:\"small\",children:[/*#__PURE__*/_jsx(Search,{placeholder:\"T\\xECm s\\u1EA3n ph\\u1EA9m...\",onSearch:handleSearch,style:{width:200},loading:loading}),/*#__PURE__*/_jsx(Search,{placeholder:\"Qu\\xE9t Serial Number...\",onSearch:handleSerialSearch,enterButton:\"Qu\\xE9t\",style:{width:200},loading:loading})]}),children:loading?/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'50px'},children:/*#__PURE__*/_jsx(Spin,{size:\"large\"})}):/*#__PURE__*/_jsx(List,{grid:{gutter:16,xs:1,sm:2,md:3,lg:3,xl:4,xxl:5},dataSource:filteredProducts,renderItem:product=>/*#__PURE__*/_jsx(List.Item,{children:/*#__PURE__*/_jsxs(Card,{hoverable:true,cover:/*#__PURE__*/_jsx(\"img\",{alt:product.name,src:product.image_url||'https://via.placeholder.com/150'}),onClick:()=>addToCart(product),style:{height:'100%',display:'flex',flexDirection:'column',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Card.Meta,{title:product.name,description:formatCurrency(product.price)}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'10px'},children:[/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[\"T\\u1ED3n kho: \",product.quantity]}),product.quantity<=10&&product.quantity>0&&/*#__PURE__*/_jsx(Tag,{color:\"warning\",style:{marginLeft:'8px'},children:\"S\\u1EAFp h\\u1EBFt\"}),product.quantity===0&&/*#__PURE__*/_jsx(Tag,{color:\"error\",style:{marginLeft:'8px'},children:\"H\\u1EBFt h\\xE0ng\"})]})]})})})})}),/*#__PURE__*/_jsx(Col,{xs:24,lg:8,children:/*#__PURE__*/_jsxs(Card,{title:\"Gi\\u1ECF h\\xE0ng\",actions:[/*#__PURE__*/_jsxs(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(ShoppingCartOutlined,{}),onClick:handleCheckout,disabled:cart.length===0,children:[\"Thanh to\\xE1n (\",getTotalItems(),\")\"]}),/*#__PURE__*/_jsx(Button,{danger:true,icon:/*#__PURE__*/_jsx(DeleteOutlined,{}),onClick:clearCart,disabled:cart.length===0,children:\"X\\xF3a gi\\u1ECF h\\xE0ng\"})],children:[/*#__PURE__*/_jsx(List,{itemLayout:\"horizontal\",dataSource:cart,renderItem:item=>/*#__PURE__*/_jsxs(List.Item,{actions:[/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(PlusOutlined,{}),onClick:()=>{var _item$serial6;return updateQuantity(item.product.id,(_item$serial6=item.serial)===null||_item$serial6===void 0?void 0:_item$serial6.serial_number,item.quantity+1);},disabled:item.quantity>=10}),/*#__PURE__*/_jsx(InputNumber,{min:1,max:10,value:item.quantity,onChange:value=>{var _item$serial7;return updateQuantity(item.product.id,(_item$serial7=item.serial)===null||_item$serial7===void 0?void 0:_item$serial7.serial_number,value);},style:{width:60}}),/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(MinusOutlined,{}),onClick:()=>{var _item$serial8;return updateQuantity(item.product.id,(_item$serial8=item.serial)===null||_item$serial8===void 0?void 0:_item$serial8.serial_number,item.quantity-1);}}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(DeleteOutlined,{style:{color:'red'}}),onClick:()=>{var _item$serial9;return removeFromCart(item.product.id,(_item$serial9=item.serial)===null||_item$serial9===void 0?void 0:_item$serial9.serial_number);}})],children:[/*#__PURE__*/_jsx(List.Item.Meta,{title:item.product.name,description:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Text,{children:[\"Gi\\xE1: \",formatCurrency(item.price)]}),/*#__PURE__*/_jsx(\"br\",{}),item.serial&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"Serial: \"}),/*#__PURE__*/_jsx(Tag,{color:\"blue\",size:\"small\",children:item.serial.serial_number})]})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Text,{strong:true,children:formatCurrency(item.price*item.quantity)})})]})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'right'},children:/*#__PURE__*/_jsxs(Title,{level:3,children:[\"T\\u1ED5ng c\\u1ED9ng: \",formatCurrency(getTotalAmount())]})})]})})]}),/*#__PURE__*/_jsx(Modal,{title:\"T\\u1EA1o \\u0111\\u01A1n h\\xE0ng\",visible:orderModalVisible,onCancel:()=>setOrderModalVisible(false),footer:null,width:600,children:/*#__PURE__*/_jsxs(Form,{layout:\"vertical\",onFinish:handleSubmit(submitOrder),children:[/*#__PURE__*/_jsx(Card,{title:\"Th\\xF4ng tin kh\\xE1ch h\\xE0ng\",size:\"small\",style:{marginBottom:16},children:selectedCustomer?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",style:{width:'100%'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"Kh\\xE1ch h\\xE0ng \\u0111\\xE3 ch\\u1ECDn:\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:8,padding:12,background:'#f6ffed',border:'1px solid #b7eb8f',borderRadius:4},children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Text,{strong:true,children:selectedCustomer.name})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[\"S\\u0110T: \",selectedCustomer.phone]})}),selectedCustomer.email&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[\"Email: \",selectedCustomer.email]})})]})]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{size:\"small\",onClick:clearSelectedCustomer,children:\"\\u0110\\u1ED5i kh\\xE1ch h\\xE0ng\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",icon:/*#__PURE__*/_jsx(UserOutlined,{}),onClick:()=>setCustomerModalVisible(true),children:\"Ch\\u1ECDn kh\\xE1ch kh\\xE1c\"})]})]})}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:16},children:[/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(UserOutlined,{}),onClick:()=>setCustomerModalVisible(true),style:{marginRight:8},children:\"Ch\\u1ECDn kh\\xE1ch h\\xE0ng c\\xF3 s\\u1EB5n\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"ho\\u1EB7c nh\\u1EADp th\\xF4ng tin kh\\xE1ch h\\xE0ng m\\u1EDBi b\\xEAn d\\u01B0\\u1EDBi\"})]}),/*#__PURE__*/_jsxs(Row,{gutter:16,children:[/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Controller,{name:\"customer_name\",control:control,render:_ref=>{var _errors$customer_name;let{field}=_ref;return/*#__PURE__*/_jsx(Form.Item,{label:\"T\\xEAn kh\\xE1ch h\\xE0ng\",help:(_errors$customer_name=errors.customer_name)===null||_errors$customer_name===void 0?void 0:_errors$customer_name.message,validateStatus:errors.customer_name?'error':'',children:/*#__PURE__*/_jsx(Input,_objectSpread(_objectSpread({},field),{},{placeholder:\"Nh\\u1EADp t\\xEAn kh\\xE1ch h\\xE0ng\"}))});}})}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(Controller,{name:\"customer_phone\",control:control,render:_ref2=>{var _errors$customer_phon;let{field}=_ref2;return/*#__PURE__*/_jsx(Form.Item,{label:\"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i\",help:(_errors$customer_phon=errors.customer_phone)===null||_errors$customer_phon===void 0?void 0:_errors$customer_phon.message,validateStatus:errors.customer_phone?'error':'',children:/*#__PURE__*/_jsx(Search,_objectSpread(_objectSpread({},field),{},{placeholder:\"Nh\\u1EADp ho\\u1EB7c t\\xECm S\\u0110T kh\\xE1ch h\\xE0ng\",onSearch:value=>{const foundCustomer=customers.find(c=>c.phone===value);if(foundCustomer){selectCustomer(foundCustomer);toast.success(\"\\u0110\\xE3 t\\xECm th\\u1EA5y kh\\xE1ch h\\xE0ng: \".concat(foundCustomer.name));}else if(value&&!field.value){setValue('customer_phone',value);}},enterButton:/*#__PURE__*/_jsx(SearchOutlined,{})}))});}})})]}),/*#__PURE__*/_jsx(Controller,{name:\"customer_email\",control:control,render:_ref3=>{var _errors$customer_emai;let{field}=_ref3;return/*#__PURE__*/_jsx(Form.Item,{label:\"Email (t\\xF9y ch\\u1ECDn)\",help:(_errors$customer_emai=errors.customer_email)===null||_errors$customer_emai===void 0?void 0:_errors$customer_emai.message,validateStatus:errors.customer_email?'error':'',children:/*#__PURE__*/_jsx(Input,_objectSpread(_objectSpread({},field),{},{placeholder:\"Nh\\u1EADp email kh\\xE1ch h\\xE0ng\",type:\"email\"}))});}}),(watch('customer_name')||watch('customer_phone'))&&/*#__PURE__*/_jsx(\"div\",{style:{padding:8,background:'#e6f7ff',border:'1px solid #91d5ff',borderRadius:4,marginTop:8},children:/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"\\uD83D\\uDCA1 N\\u1EBFu kh\\xE1ch h\\xE0ng ch\\u01B0a c\\xF3 trong h\\u1EC7 th\\u1ED1ng, th\\xF4ng tin s\\u1EBD \\u0111\\u01B0\\u1EE3c t\\u1EF1 \\u0111\\u1ED9ng t\\u1EA1o m\\u1EDBi v\\xE0 \\u0111\\u1ED3ng b\\u1ED9 v\\u1EDBi trang Kh\\xE1ch h\\xE0ng\"})})]})}),/*#__PURE__*/_jsx(Controller,{name:\"payment_method\",control:control,defaultValue:\"cash\",render:_ref4=>{let{field}=_ref4;return/*#__PURE__*/_jsx(Form.Item,{label:\"Ph\\u01B0\\u01A1ng th\\u1EE9c thanh to\\xE1n\",children:/*#__PURE__*/_jsxs(Radio.Group,_objectSpread(_objectSpread({},field),{},{children:[/*#__PURE__*/_jsx(Radio,{value:\"cash\",children:\"Ti\\u1EC1n m\\u1EB7t\"}),/*#__PURE__*/_jsx(Radio,{value:\"card\",children:\"Th\\u1EBB\"}),/*#__PURE__*/_jsx(Radio,{value:\"transfer\",children:\"Chuy\\u1EC3n kho\\u1EA3n\"}),/*#__PURE__*/_jsx(Radio,{value:\"ewallet\",children:\"V\\xED \\u0111i\\u1EC7n t\\u1EED\"})]}))});}}),/*#__PURE__*/_jsx(Controller,{name:\"notes\",control:control,render:_ref5=>{let{field}=_ref5;return/*#__PURE__*/_jsx(Form.Item,{label:\"Ghi ch\\xFA \\u0111\\u01A1n h\\xE0ng\",children:/*#__PURE__*/_jsx(Input.TextArea,_objectSpread(_objectSpread({},field),{},{rows:3,placeholder:\"Ghi ch\\xFA v\\u1EC1 \\u0111\\u01A1n h\\xE0ng...\"}))});}}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'right',marginBottom:'20px'},children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",align:\"end\",children:[/*#__PURE__*/_jsxs(Text,{children:[\"S\\u1ED1 l\\u01B0\\u1EE3ng: \",getTotalItems(),\" s\\u1EA3n ph\\u1EA9m\"]}),/*#__PURE__*/_jsxs(Title,{level:4,style:{margin:0,color:'#1890ff'},children:[\"T\\u1ED5ng ti\\u1EC1n: \",formatCurrency(getTotalAmount())]})]})}),/*#__PURE__*/_jsx(Form.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",block:true,size:\"large\",loading:loading,children:\"Ho\\xE0n t\\u1EA5t \\u0111\\u01A1n h\\xE0ng\"})})]})}),/*#__PURE__*/_jsxs(Modal,{title:\"Ch\\u1ECDn kh\\xE1ch h\\xE0ng\",visible:customerModalVisible,onCancel:()=>setCustomerModalVisible(false),footer:null,width:800,children:[/*#__PURE__*/_jsx(Search,{placeholder:\"T\\xECm kh\\xE1ch h\\xE0ng theo t\\xEAn ho\\u1EB7c s\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i...\",onSearch:handleCustomerSearch,style:{marginBottom:16}}),/*#__PURE__*/_jsx(Table,{dataSource:filteredCustomers,columns:customerColumns,rowKey:\"id\",pagination:{pageSize:5},scroll:{y:300}})]}),/*#__PURE__*/_jsx(Modal,{title:\"Ch\\u1ECDn Serial - \".concat(selectedProductForSerial===null||selectedProductForSerial===void 0?void 0:selectedProductForSerial.name),visible:serialModalVisible,onCancel:()=>setSerialModalVisible(false),footer:[/*#__PURE__*/_jsx(Button,{onClick:()=>setSerialModalVisible(false),children:\"H\\u1EE7y\"},\"cancel\"),/*#__PURE__*/_jsxs(Button,{type:\"primary\",onClick:()=>addSerialToCart(selectedSerials),disabled:selectedSerials.length===0,children:[\"Th\\xEAm v\\xE0o gi\\u1ECF (\",selectedSerials.length,\")\"]},\"add\")],width:800,children:availableSerials.length===0?/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'20px'},children:/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"Kh\\xF4ng c\\xF3 serial kh\\u1EA3 d\\u1EE5ng cho s\\u1EA3n ph\\u1EA9m n\\xE0y\"})}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:16},children:/*#__PURE__*/_jsxs(Text,{strong:true,children:[\"C\\xF3 \",availableSerials.length,\" serial kh\\u1EA3 d\\u1EE5ng\"]})}),/*#__PURE__*/_jsx(List,{dataSource:availableSerials,renderItem:serial=>/*#__PURE__*/_jsx(List.Item,{style:{cursor:'pointer',backgroundColor:selectedSerials.find(s=>s.id===serial.id)?'#e6f7ff':'transparent',border:selectedSerials.find(s=>s.id===serial.id)?'1px solid #1890ff':'1px solid #f0f0f0',marginBottom:8,padding:12,borderRadius:4},onClick:()=>{const isSelected=selectedSerials.find(s=>s.id===serial.id);if(isSelected){setSelectedSerials(selectedSerials.filter(s=>s.id!==serial.id));}else{setSelectedSerials([...selectedSerials,serial]);}},children:/*#__PURE__*/_jsx(List.Item.Meta,{title:/*#__PURE__*/_jsx(Text,{code:true,children:serial.serial_number}),description:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Tag,{color:\"green\",children:serial.status}),/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:serial.condition_grade}),serial.location&&/*#__PURE__*/_jsxs(\"span\",{children:[\"V\\u1ECB tr\\xED: \",serial.location]})]})})})})]})}),/*#__PURE__*/_jsx(ToastContainer,{position:\"bottom-right\",autoClose:3000,hideProgressBar:false,newestOnTop:false,closeOnClick:true,rtl:false,pauseOnFocusLoss:true,draggable:true,pauseOnHover:true})]});}export default POSPage;","map":{"version":3,"names":["React","useState","useEffect","Row","Col","Card","Input","Button","List","Typography","message","Modal","Form","InputNumber","Space","Tag","Divider","Spin","Table","Radio","PlusOutlined","MinusOutlined","DeleteOutlined","ShoppingCartOutlined","PrinterOutlined","SearchOutlined","ShoppingOutlined","UserOutlined","useForm","Controller","zodResolver","z","toast","ToastContainer","productsAPI","ordersAPI","customersAPI","formatCurrency","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Title","Text","Search","orderSchema","object","customer_id","number","int","positive","optional","nullable","customer_name","string","customer_phone","customer_email","email","or","literal","payment_method","enum","notes","POSPage","products","setProducts","filteredProducts","setFilteredProducts","cart","setCart","loading","setLoading","orderModalVisible","setOrderModalVisible","customerModalVisible","setCustomerModalVisible","customers","setCustomers","filteredCustomers","setFilteredCustomers","selectedCustomer","setSelectedCustomer","serialModalVisible","setSerialModalVisible","selectedProductForSerial","setSelectedProductForSerial","availableSerials","setAvailableSerials","selectedSerials","setSelectedSerials","control","handleSubmit","formState","errors","setValue","watch","reset","resolver","defaultValues","customerPhoneWatch","fetchProducts","fetchCustomers","id","name","phone","searchQuery","arguments","length","undefined","response","getAll","data","success","error","console","handleCustomerSearch","value","filtered","filter","customer","_customer$phone","toLowerCase","includes","selectCustomer","clearSelectedCustomer","handleSearch","product","_product$sku","_product$barcode","sku","barcode","handleSerialSearch","serialNumber","trim","searchSerials","q","status","serial","find","p","product_id","existingItem","item","_item$serial","serial_number","warning","concat","prev","quantity","price","showSerialModal","getSerials","Array","isArray","addToCart","addSerialToCart","forEach","_item$serial2","removeFromCart","productId","_item$serial3","updateQuantity","newQuantity","map","_item$serial4","_objectSpread","clearCart","getTotalAmount","reduce","total","getTotalItems","handleCheckout","submitOrder","values","serialsToSell","push","orderData","items","_item$serial5","product_name","subtotal","total_amount","serials_sold","create","sellSerials","serial_numbers","order_id","sold_price","order_number","showPrintModal","_error$response","_error$response$data","errorMessage","order","_order$customer","_order$customer2","_order$customer3","modalInstance","autoCloseTimer","info","title","width","content","style","padding","children","textAlign","marginBottom","level","type","Date","created_at","toLocaleString","strong","size","dataSource","renderItem","Item","display","justifyContent","serials","marginTop","fontSize","join","margin","footer","icon","onClick","window","print","destroy","clearTimeout","setTimeout","customerColumns","dataIndex","key","render","_","record","className","gutter","xs","lg","extra","direction","placeholder","onSearch","enterButton","grid","sm","md","xl","xxl","hoverable","cover","alt","src","image_url","height","flexDirection","Meta","description","color","marginLeft","actions","disabled","danger","itemLayout","_item$serial6","min","max","onChange","_item$serial7","_item$serial8","_item$serial9","visible","onCancel","layout","onFinish","background","border","borderRadius","marginRight","span","_ref","_errors$customer_name","field","label","help","validateStatus","_ref2","_errors$customer_phon","foundCustomer","c","_ref3","_errors$customer_emai","defaultValue","_ref4","Group","_ref5","TextArea","rows","align","htmlType","block","columns","rowKey","pagination","pageSize","scroll","y","cursor","backgroundColor","s","isSelected","code","condition_grade","location","position","autoClose","hideProgressBar","newestOnTop","closeOnClick","rtl","pauseOnFocusLoss","draggable","pauseOnHover"],"sources":["C:/Users/ADMIN/Desktop/kho/kho/client/src/pages/POSPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Row, \r\n  Col, \r\n  Card, \r\n  Input, \r\n  Button, \r\n  List, \r\n  Typography, \r\n  message, \r\n  Modal,\r\n  Form,\r\n  InputNumber,\r\n  Space,\r\n  Tag,\r\n  Divider,\r\n  Spin,\r\n  Table,\r\n  Radio\r\n} from 'antd';\r\nimport { \r\n  PlusOutlined, \r\n  MinusOutlined, \r\n  DeleteOutlined,\r\n  ShoppingCartOutlined,\r\n  PrinterOutlined,\r\n  SearchOutlined,\r\n  ShoppingOutlined,\r\n  UserOutlined\r\n} from '@ant-design/icons';\r\nimport { useForm, Controller } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport * as z from 'zod';\r\nimport { toast, ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\n\r\nimport { productsAPI, ordersAPI, customersAPI } from '../services/api';\r\nimport { formatCurrency } from '../utils/format';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Search } = Input;\r\n\r\nconst orderSchema = z.object({\r\n  customer_id: z.number().int().positive().optional().nullable(),\r\n  customer_name: z.string().optional(),\r\n  customer_phone: z.string().optional(),\r\n  customer_email: z.string().email('Email không hợp lệ').optional().or(z.literal('')),\r\n  payment_method: z.enum(['cash', 'card', 'transfer', 'ewallet']).optional(),\r\n  notes: z.string().optional(),\r\n});\r\n\r\nfunction POSPage() {\r\n  const [products, setProducts] = useState([]);\r\n  const [filteredProducts, setFilteredProducts] = useState([]);\r\n  const [cart, setCart] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [orderModalVisible, setOrderModalVisible] = useState(false);\r\n  const [customerModalVisible, setCustomerModalVisible] = useState(false);\r\n  const [customers, setCustomers] = useState([]);\r\n  const [filteredCustomers, setFilteredCustomers] = useState([]);\r\n  const [selectedCustomer, setSelectedCustomer] = useState(null);\r\n  const [serialModalVisible, setSerialModalVisible] = useState(false);\r\n  const [selectedProductForSerial, setSelectedProductForSerial] = useState(null);\r\n  const [availableSerials, setAvailableSerials] = useState([]);\r\n  const [selectedSerials, setSelectedSerials] = useState([]);\r\n\r\n  const { control, handleSubmit, formState: { errors }, setValue, watch, reset } = useForm({\r\n    resolver: zodResolver(orderSchema),\r\n    defaultValues: {\r\n      customer_id: null,\r\n      customer_name: '',\r\n      customer_phone: '',\r\n      customer_email: '',\r\n      payment_method: 'cash',\r\n      notes: '',\r\n    }\r\n  });\r\n\r\n  const customerPhoneWatch = watch('customer_phone');\r\n\r\n  useEffect(() => {\r\n    fetchProducts();\r\n    fetchCustomers();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selectedCustomer) {\r\n      setValue('customer_id', selectedCustomer.id);\r\n      setValue('customer_name', selectedCustomer.name);\r\n      setValue('customer_phone', selectedCustomer.phone);\r\n      setValue('customer_email', selectedCustomer.email || '');\r\n    } else {\r\n      setValue('customer_id', null);\r\n    }\r\n  }, [selectedCustomer, setValue]);\r\n\r\n  const fetchCustomers = async (searchQuery = '') => {\r\n    try {\r\n      const response = await customersAPI.getAll({ phone: searchQuery, name: searchQuery });\r\n      if (\r\n        response.data.success) {\r\n        setCustomers(response.data.data || []);\r\n        setFilteredCustomers(response.data.data || []);\r\n      } else {\r\n        setCustomers([]);\r\n        toast.error('Lỗi khi lấy danh sách khách hàng: ' + response.data.message);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching customers:', error);\r\n      setCustomers([]);\r\n      toast.error('Lỗi kết nối khi lấy danh sách khách hàng.');\r\n    }\r\n  };\r\n\r\n  const handleCustomerSearch = (value) => {\r\n    const filtered = customers.filter(customer =>\r\n      customer.name.toLowerCase().includes(value.toLowerCase()) ||\r\n      customer.phone?.includes(value)\r\n    );\r\n    setFilteredCustomers(filtered);\r\n  };\r\n\r\n  const selectCustomer = (customer) => {\r\n    setSelectedCustomer(customer);\r\n    setCustomerModalVisible(false);\r\n  };\r\n\r\n  const clearSelectedCustomer = () => {\r\n    setSelectedCustomer(null);\r\n    setValue('customer_id', null);\r\n    setValue('customer_name', '');\r\n    setValue('customer_phone', '');\r\n    setValue('customer_email', '');\r\n  };\r\n\r\n  const fetchProducts = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await productsAPI.getAll();\r\n      if (response.data.success) {\r\n        setProducts(response.data.data || []);\r\n        setFilteredProducts(response.data.data || []);\r\n      } else {\r\n        setProducts([]);\r\n        console.error('API returned error:', response.data.message);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching products:', error);\r\n      setProducts([]);\r\n      // Don't show error message to user, just silently handle it\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSearch = (value) => {\r\n    const filtered = products.filter(product =>\r\n      product.name.toLowerCase().includes(value.toLowerCase()) ||\r\n      product.sku?.toLowerCase().includes(value.toLowerCase()) ||\r\n      product.barcode?.toLowerCase().includes(value.toLowerCase())\r\n    );\r\n    setFilteredProducts(filtered);\r\n  };\r\n\r\n  const handleSerialSearch = async (serialNumber) => {\r\n    if (!serialNumber.trim()) {\r\n      setFilteredProducts(products);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Tìm kiếm serial trong database\r\n              const response = await productsAPI.searchSerials({ \r\n        q: serialNumber, \r\n        status: 'available' \r\n      });\r\n      \r\n      if (response.data.success && response.data.data.length > 0) {\r\n        const serial = response.data.data[0];\r\n        \r\n        // Tìm sản phẩm tương ứng với serial\r\n        const product = products.find(p => p.id === serial.product_id);\r\n        \r\n        if (product) {\r\n          // Hiển thị sản phẩm tìm thấy\r\n          setFilteredProducts([product]);\r\n          \r\n          // Tự động thêm serial vào giỏ hàng\r\n          const existingItem = cart.find(item => \r\n            item.product.id === product.id && \r\n            item.serial?.serial_number === serial.serial_number\r\n          );\r\n          \r\n          if (existingItem) {\r\n            message.warning(`Serial ${serial.serial_number} đã có trong giỏ hàng`);\r\n          } else {\r\n            setCart(prev => [...prev, {\r\n              product: product,\r\n              quantity: 1,\r\n              serial: serial,\r\n              price: product.price\r\n            }]);\r\n            message.success(`Đã thêm sản phẩm ${product.name} (Serial: ${serial.serial_number}) vào giỏ hàng`);\r\n          }\r\n        } else {\r\n          message.error('Không tìm thấy sản phẩm tương ứng với serial này');\r\n        }\r\n      } else {\r\n        message.error('Không tìm thấy serial hoặc serial đã được bán');\r\n        setFilteredProducts(products);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching serial:', error);\r\n      message.error('Lỗi khi tìm kiếm serial');\r\n      setFilteredProducts(products);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const showSerialModal = async (product) => {\r\n    try {\r\n      setSelectedProductForSerial(product);\r\n              const response = await productsAPI.getSerials(product.id, { status: 'available' });\r\n      if (response.data.success) {\r\n        setAvailableSerials(Array.isArray(response.data.data) ? response.data.data : []);\r\n      } else {\r\n        setAvailableSerials([]);\r\n      }\r\n      setSerialModalVisible(true);\r\n    } catch (error) {\r\n      console.error('Error fetching serials:', error);\r\n      setAvailableSerials([]);\r\n      toast.error('Không thể tải danh sách serial của sản phẩm');\r\n    }\r\n  };\r\n\r\n  const addToCart = async (product) => {\r\n    try {\r\n      // Thay vì thêm trực tiếp vào giỏ hàng, hiển thị modal chọn serial\r\n      await showSerialModal(product);\r\n    } catch (error) {\r\n      console.error('Error adding to cart:', error);\r\n      message.error('Lỗi khi thêm sản phẩm vào giỏ hàng');\r\n    }\r\n  };\r\n\r\n  const addSerialToCart = (selectedSerials) => {\r\n    if (!selectedSerials || selectedSerials.length === 0) {\r\n      message.warning('Vui lòng chọn ít nhất một serial');\r\n      return;\r\n    }\r\n\r\n    selectedSerials.forEach(serial => {\r\n      const existingItem = cart.find(item => \r\n        item.product.id === selectedProductForSerial.id && \r\n        item.serial?.serial_number === serial.serial_number\r\n      );\r\n      \r\n      if (existingItem) {\r\n        message.warning(`Serial ${serial.serial_number} đã có trong giỏ hàng`);\r\n        return;\r\n      }\r\n\r\n      setCart(prev => [...prev, {\r\n        product: selectedProductForSerial,\r\n        quantity: 1,\r\n        serial: serial,\r\n        price: selectedProductForSerial.price\r\n      }]);\r\n    });\r\n\r\n    message.success(`Đã thêm ${selectedSerials.length} sản phẩm vào giỏ hàng`);\r\n    setSerialModalVisible(false);\r\n    setSelectedSerials([]);\r\n  };\r\n\r\n  const removeFromCart = (productId, serialNumber) => {\r\n    if (serialNumber) {\r\n      // Xóa item có serial cụ thể\r\n      setCart(prev => prev.filter(item => \r\n        !(item.product.id === productId && item.serial?.serial_number === serialNumber)\r\n      ));\r\n    } else {\r\n      // Xóa tất cả item của sản phẩm này (fallback)\r\n      setCart(prev => prev.filter(item => item.product.id !== productId));\r\n    }\r\n  };\r\n\r\n  const updateQuantity = (productId, serialNumber, newQuantity) => {\r\n    if (newQuantity <= 0) {\r\n      removeFromCart(productId, serialNumber);\r\n      return;\r\n    }\r\n    \r\n    setCart(prev => prev.map(item => {\r\n      if (item.product.id === productId && item.serial?.serial_number === serialNumber) {\r\n        return { ...item, quantity: newQuantity };\r\n      }\r\n      return item;\r\n    }));\r\n  };\r\n\r\n  const clearCart = () => {\r\n    setCart([]);\r\n  };\r\n\r\n  const getTotalAmount = () => {\r\n    return cart.reduce((total, item) => total + (item.price * item.quantity), 0);\r\n  };\r\n\r\n  const getTotalItems = () => {\r\n    return cart.reduce((total, item) => total + item.quantity, 0);\r\n  };\r\n\r\n  const handleCheckout = () => {\r\n    if (cart.length === 0) {\r\n      toast.warning('Giỏ hàng trống');\r\n      return;\r\n    }\r\n    setOrderModalVisible(true);\r\n  };\r\n\r\n  const submitOrder = async (values) => {\r\n    setLoading(true);\r\n    try {\r\n      // Tổng hợp tất cả serial để bán\r\n      const serialsToSell = [];\r\n      cart.forEach(item => {\r\n        if (item.serial && item.serial.serial_number) {\r\n          serialsToSell.push(item.serial.serial_number);\r\n        }\r\n      });\r\n\r\n      const orderData = {\r\n        customer_id: selectedCustomer?.id || null,\r\n        customer_name: selectedCustomer?.name || values.customer_name || null,\r\n        customer_phone: selectedCustomer?.phone || values.customer_phone || null,\r\n        customer_email: selectedCustomer?.email || values.customer_email || null,\r\n        payment_method: values.payment_method || 'cash',\r\n        items: cart.map(item => ({\r\n          product_id: item.product.id,\r\n          product_name: item.product.name,\r\n          quantity: item.quantity,\r\n          price: item.price,\r\n          subtotal: item.quantity * item.price,\r\n          serial_number: item.serial?.serial_number || null\r\n        })),\r\n        total_amount: getTotalAmount(),\r\n        serials_sold: serialsToSell,\r\n        notes: values.notes || null\r\n      };\r\n\r\n      const response = await ordersAPI.create(orderData);\r\n      \r\n      if (response.data.success) {\r\n        // Đánh dấu serial đã bán\r\n        if (serialsToSell.length > 0) {\r\n          await productsAPI.sellSerials({\r\n            serial_numbers: serialsToSell,\r\n            order_id: response.data.data.id,\r\n            customer_id: response.data.data.customer_id || selectedCustomer?.id || null,\r\n            sold_price: getTotalAmount(),\r\n            notes: `Bán qua POS - ${response.data.data.order_number}`\r\n          });\r\n        }\r\n\r\n        // Refresh customer list to sync with customers page\r\n        await fetchCustomers();\r\n\r\n        toast.success('Tạo đơn hàng thành công!');\r\n        setSelectedCustomer(null);\r\n        clearCart();\r\n        setOrderModalVisible(false);\r\n        reset(); // Reset form\r\n        fetchProducts();\r\n        showPrintModal(response.data.data);\r\n      } else {\r\n        toast.error(response.data.message || 'Lỗi khi tạo đơn hàng');\r\n      }\r\n    } catch (error) {\r\n      const errorMessage = error.response?.data?.message || 'Lỗi kết nối khi tạo đơn hàng.';\r\n      toast.error(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const showPrintModal = (order) => {\r\n    let modalInstance = null;\r\n    let autoCloseTimer = null;\r\n    modalInstance = Modal.info({\r\n      title: 'Hóa đơn bán hàng',\r\n      width: 600,\r\n      content: (\r\n        <div style={{ padding: '20px 0' }}>\r\n          <div style={{ textAlign: 'center', marginBottom: '20px' }}>\r\n            <Title level={4}>HÓA ĐƠN BÁN HÀNG</Title>\r\n            <Text>Số hóa đơn: {order.order_number}</Text><br/>\r\n            <Text type=\"secondary\">\r\n              {new Date(order.created_at).toLocaleString('vi-VN')}\r\n            </Text>\r\n          </div>\r\n          <Divider />\r\n          <div style={{ marginBottom: '16px' }}>\r\n            <Text strong>Khách hàng: </Text>\r\n            <Text>{order.customer?.name || order.customer_name}</Text><br/>\r\n            {(order.customer?.phone || order.customer_phone) && (\r\n              <>\r\n                <Text strong>Số điện thoại: </Text>\r\n                <Text>{order.customer?.phone || order.customer_phone}</Text>\r\n              </>\r\n            )}\r\n          </div>\r\n          <Divider />\r\n          <List\r\n            size=\"small\"\r\n            dataSource={order.items}\r\n            renderItem={item => (\r\n              <List.Item style={{ padding: '8px 0' }}>\r\n                <div style={{ width: '100%' }}>\r\n                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                    <div>\r\n                      <Text strong>{item.product_name}</Text><br/>\r\n                      <Text type=\"secondary\">{item.quantity} x {formatCurrency(item.price)}</Text>\r\n                      {item.serials && item.serials.length > 0 && (\r\n                        <div style={{ marginTop: 4 }}>\r\n                          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n                            Serial: {item.serials.join(', ')}\r\n                          </Text>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <Text strong>{formatCurrency(item.subtotal)}</Text>\r\n                  </div>\r\n                </div>\r\n              </List.Item>\r\n            )}\r\n          />\r\n          <Divider />\r\n          <div style={{ textAlign: 'right' }}>\r\n            <Title level={4} style={{ margin: 0 }}>\r\n              Tổng cộng: {formatCurrency(order.total_amount)}\r\n            </Title>\r\n          </div>\r\n        </div>\r\n      ),\r\n      footer: [\r\n        <Button \r\n          key=\"print\"\r\n          type=\"primary\" \r\n          icon={<PrinterOutlined />}\r\n          onClick={() => window.print()}\r\n        >\r\n          In hóa đơn\r\n        </Button>,\r\n        <Button\r\n          key=\"close\"\r\n          onClick={() => { if (modalInstance) modalInstance.destroy(); if (autoCloseTimer) clearTimeout(autoCloseTimer); }}\r\n        >\r\n          Đóng\r\n        </Button>\r\n      ]\r\n    });\r\n    autoCloseTimer = setTimeout(() => {\r\n      if (modalInstance) modalInstance.destroy();\r\n    }, 5000);\r\n  };\r\n\r\n  const customerColumns = [\r\n    {\r\n      title: 'Tên khách hàng',\r\n      dataIndex: 'name',\r\n      key: 'name',\r\n    },\r\n    {\r\n      title: 'Số điện thoại',\r\n      dataIndex: 'phone',\r\n      key: 'phone',\r\n    },\r\n    {\r\n      title: 'Email',\r\n      dataIndex: 'email',\r\n      key: 'email',\r\n    },\r\n    {\r\n      title: 'Địa chỉ',\r\n      dataIndex: 'address',\r\n      key: 'address',\r\n    },\r\n    {\r\n      title: 'Hành động',\r\n      key: 'action',\r\n      render: (_, record) => (\r\n        <Button type=\"link\" onClick={() => selectCustomer(record)}>Chọn</Button>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"pos-page\">\r\n      <Row gutter={[16, 16]}>\r\n        <Col xs={24} lg={16}>\r\n          <Card \r\n            title=\"Danh sách sản phẩm\"\r\n            extra={\r\n              <Space direction=\"vertical\" size=\"small\">\r\n                <Search\r\n                  placeholder=\"Tìm sản phẩm...\"\r\n                  onSearch={handleSearch}\r\n                  style={{ width: 200 }}\r\n                  loading={loading}\r\n                />\r\n                <Search\r\n                  placeholder=\"Quét Serial Number...\"\r\n                  onSearch={handleSerialSearch}\r\n                  enterButton=\"Quét\"\r\n                  style={{ width: 200 }}\r\n                  loading={loading}\r\n                />\r\n              </Space>\r\n            }\r\n          >\r\n            {loading ? (\r\n              <div style={{ textAlign: 'center', padding: '50px' }}>\r\n                <Spin size=\"large\" />\r\n              </div>\r\n            ) : (\r\n              <List\r\n                grid={{ gutter: 16, xs: 1, sm: 2, md: 3, lg: 3, xl: 4, xxl: 5 }}\r\n                dataSource={filteredProducts}\r\n                renderItem={product => (\r\n                  <List.Item>\r\n                    <Card\r\n                      hoverable\r\n                      cover={<img alt={product.name} src={product.image_url || 'https://via.placeholder.com/150'} />}\r\n                      onClick={() => addToCart(product)}\r\n                      style={{ height: '100%', display: 'flex', flexDirection: 'column', justifyContent: 'space-between' }}\r\n                    >\r\n                      <Card.Meta \r\n                        title={product.name}\r\n                        description={formatCurrency(product.price)}\r\n                      />\r\n                      <div style={{ marginTop: '10px' }}>\r\n                        <Text type=\"secondary\">Tồn kho: {product.quantity}</Text>\r\n                        {product.quantity <= 10 && product.quantity > 0 && (\r\n                          <Tag color=\"warning\" style={{ marginLeft: '8px' }}>Sắp hết</Tag>\r\n                        )}\r\n                        {product.quantity === 0 && (\r\n                          <Tag color=\"error\" style={{ marginLeft: '8px' }}>Hết hàng</Tag>\r\n                        )}\r\n                      </div>\r\n                    </Card>\r\n                  </List.Item>\r\n                )}\r\n              />\r\n            )}\r\n          </Card>\r\n        </Col>\r\n\r\n        <Col xs={24} lg={8}>\r\n          <Card\r\n            title=\"Giỏ hàng\"\r\n            actions={[\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<ShoppingCartOutlined />}\r\n                onClick={handleCheckout}\r\n                disabled={cart.length === 0}\r\n              >\r\n                Thanh toán ({getTotalItems()})\r\n              </Button>,\r\n              <Button\r\n                danger\r\n                icon={<DeleteOutlined />}\r\n                onClick={clearCart}\r\n                disabled={cart.length === 0}\r\n              >\r\n                Xóa giỏ hàng\r\n              </Button>,\r\n            ]}\r\n          >\r\n            <List\r\n              itemLayout=\"horizontal\"\r\n              dataSource={cart}\r\n              renderItem={item => (\r\n                <List.Item\r\n                  actions={[\r\n                    <Button \r\n                      icon={<PlusOutlined />} \r\n                      onClick={() => updateQuantity(item.product.id, item.serial?.serial_number, item.quantity + 1)}\r\n                      disabled={item.quantity >= 10}\r\n                    />,\r\n                    <InputNumber\r\n                      min={1}\r\n                      max={10}\r\n                      value={item.quantity}\r\n                      onChange={(value) => updateQuantity(item.product.id, item.serial?.serial_number, value)}\r\n                      style={{ width: 60 }}\r\n                    />,\r\n                    <Button \r\n                      icon={<MinusOutlined />} \r\n                      onClick={() => updateQuantity(item.product.id, item.serial?.serial_number, item.quantity - 1)}\r\n                    />,\r\n                    <Button \r\n                      type=\"text\" \r\n                      icon={<DeleteOutlined style={{ color: 'red' }} />} \r\n                      onClick={() => removeFromCart(item.product.id, item.serial?.serial_number)}\r\n                    />\r\n                  ]}\r\n                >\r\n                  <List.Item.Meta\r\n                    title={item.product.name}\r\n                    description={\r\n                      <div>\r\n                        <Text>Giá: {formatCurrency(item.price)}</Text><br/>\r\n                        {item.serial && (\r\n                          <div>\r\n                            <Text type=\"secondary\">Serial: </Text>\r\n                            <Tag color=\"blue\" size=\"small\">\r\n                              {item.serial.serial_number}\r\n                            </Tag>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    }\r\n                  />\r\n                  <div>\r\n                    <Text strong>{formatCurrency(item.price * item.quantity)}</Text>\r\n                  </div>\r\n                </List.Item>\r\n              )}\r\n            />\r\n            <Divider />\r\n            <div style={{ textAlign: 'right' }}>\r\n              <Title level={3}>Tổng cộng: {formatCurrency(getTotalAmount())}</Title>\r\n            </div>\r\n          </Card>\r\n        </Col>\r\n      </Row>\r\n\r\n      <Modal\r\n        title=\"Tạo đơn hàng\"\r\n        visible={orderModalVisible}\r\n        onCancel={() => setOrderModalVisible(false)}\r\n        footer={null}\r\n        width={600}\r\n      >\r\n        <Form layout=\"vertical\" onFinish={handleSubmit(submitOrder)}>\r\n          <Card title=\"Thông tin khách hàng\" size=\"small\" style={{ marginBottom: 16 }}>\r\n            {selectedCustomer ? (\r\n              <div>\r\n                <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n                  <div>\r\n                    <Text strong>Khách hàng đã chọn:</Text>\r\n                    <div style={{ marginTop: 8, padding: 12, background: '#f6ffed', border: '1px solid #b7eb8f', borderRadius: 4 }}>\r\n                      <div><Text strong>{selectedCustomer.name}</Text></div>\r\n                      <div><Text type=\"secondary\">SĐT: {selectedCustomer.phone}</Text></div>\r\n                      {selectedCustomer.email && <div><Text type=\"secondary\">Email: {selectedCustomer.email}</Text></div>}\r\n                    </div>\r\n                  </div>\r\n                  <Space>\r\n                    <Button size=\"small\" onClick={clearSelectedCustomer}>Đổi khách hàng</Button>\r\n                    <Button \r\n                      size=\"small\"\r\n                      icon={<UserOutlined />} \r\n                      onClick={() => setCustomerModalVisible(true)}\r\n                    >\r\n                      Chọn khách khác\r\n                    </Button>\r\n                  </Space>\r\n                </Space>\r\n              </div>\r\n            ) : (\r\n              <div>\r\n                <div style={{ marginBottom: 16 }}>\r\n                  <Button \r\n                    icon={<UserOutlined />} \r\n                    onClick={() => setCustomerModalVisible(true)}\r\n                    style={{ marginRight: 8 }}\r\n                  >\r\n                    Chọn khách hàng có sẵn\r\n                  </Button>\r\n                  <Text type=\"secondary\">hoặc nhập thông tin khách hàng mới bên dưới</Text>\r\n                </div>\r\n                \r\n                <Row gutter={16}>\r\n                  <Col span={12}>\r\n                    <Controller\r\n                      name=\"customer_name\"\r\n                      control={control}\r\n                      render={({ field }) => (\r\n                        <Form.Item label=\"Tên khách hàng\" help={errors.customer_name?.message} validateStatus={errors.customer_name ? 'error' : ''}>\r\n                          <Input {...field} placeholder=\"Nhập tên khách hàng\" />\r\n                        </Form.Item>\r\n                      )}\r\n                    />\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Controller\r\n                      name=\"customer_phone\"\r\n                      control={control}\r\n                      render={({ field }) => (\r\n                        <Form.Item label=\"Số điện thoại\" help={errors.customer_phone?.message} validateStatus={errors.customer_phone ? 'error' : ''}>\r\n                          <Search\r\n                            {...field}\r\n                            placeholder=\"Nhập hoặc tìm SĐT khách hàng\"\r\n                            onSearch={(value) => {\r\n                              const foundCustomer = customers.find(c => c.phone === value);\r\n                              if (foundCustomer) {\r\n                                selectCustomer(foundCustomer);\r\n                                toast.success(`Đã tìm thấy khách hàng: ${foundCustomer.name}`);\r\n                              } else if (value && !field.value) {\r\n                                setValue('customer_phone', value);\r\n                              }\r\n                            }}\r\n                            enterButton={<SearchOutlined />}\r\n                          />\r\n                        </Form.Item>\r\n                      )}\r\n                    />\r\n                  </Col>\r\n                </Row>\r\n                \r\n                <Controller\r\n                  name=\"customer_email\"\r\n                  control={control}\r\n                  render={({ field }) => (\r\n                    <Form.Item label=\"Email (tùy chọn)\" help={errors.customer_email?.message} validateStatus={errors.customer_email ? 'error' : ''}>\r\n                      <Input {...field} placeholder=\"Nhập email khách hàng\" type=\"email\" />\r\n                    </Form.Item>\r\n                  )}\r\n                />\r\n                \r\n                {(watch('customer_name') || watch('customer_phone')) && (\r\n                  <div style={{ padding: 8, background: '#e6f7ff', border: '1px solid #91d5ff', borderRadius: 4, marginTop: 8 }}>\r\n                    <Text type=\"secondary\">\r\n                      💡 Nếu khách hàng chưa có trong hệ thống, thông tin sẽ được tự động tạo mới và đồng bộ với trang Khách hàng\r\n                    </Text>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </Card>\r\n\r\n          <Controller\r\n            name=\"payment_method\"\r\n            control={control}\r\n            defaultValue=\"cash\"\r\n            render={({ field }) => (\r\n              <Form.Item label=\"Phương thức thanh toán\">\r\n                <Radio.Group {...field}>\r\n                  <Radio value=\"cash\">Tiền mặt</Radio>\r\n                  <Radio value=\"card\">Thẻ</Radio>\r\n                  <Radio value=\"transfer\">Chuyển khoản</Radio>\r\n                  <Radio value=\"ewallet\">Ví điện tử</Radio>\r\n                </Radio.Group>\r\n              </Form.Item>\r\n            )}\r\n          />\r\n\r\n          <Controller\r\n            name=\"notes\"\r\n            control={control}\r\n            render={({ field }) => (\r\n              <Form.Item label=\"Ghi chú đơn hàng\">\r\n                <Input.TextArea {...field} rows={3} placeholder=\"Ghi chú về đơn hàng...\" />\r\n              </Form.Item>\r\n            )}\r\n          />\r\n\r\n          <Divider />\r\n\r\n          <div style={{ textAlign: 'right', marginBottom: '20px' }}>\r\n            <Space direction=\"vertical\" align=\"end\">\r\n              <Text>Số lượng: {getTotalItems()} sản phẩm</Text>\r\n              <Title level={4} style={{ margin: 0, color: '#1890ff' }}>\r\n                Tổng tiền: {formatCurrency(getTotalAmount())}\r\n              </Title>\r\n            </Space>\r\n          </div>\r\n\r\n          <Form.Item>\r\n            <Button type=\"primary\" htmlType=\"submit\" block size=\"large\" loading={loading}>\r\n              Hoàn tất đơn hàng\r\n            </Button>\r\n          </Form.Item>\r\n        </Form>\r\n      </Modal>\r\n\r\n      <Modal\r\n        title=\"Chọn khách hàng\"\r\n        visible={customerModalVisible}\r\n        onCancel={() => setCustomerModalVisible(false)}\r\n        footer={null}\r\n        width={800}\r\n      >\r\n        <Search\r\n          placeholder=\"Tìm khách hàng theo tên hoặc số điện thoại...\"\r\n          onSearch={handleCustomerSearch}\r\n          style={{ marginBottom: 16 }}\r\n        />\r\n        <Table\r\n          dataSource={filteredCustomers}\r\n          columns={customerColumns}\r\n          rowKey=\"id\"\r\n          pagination={{ pageSize: 5 }}\r\n          scroll={{ y: 300 }}\r\n        />\r\n      </Modal>\r\n\r\n      <Modal\r\n        title={`Chọn Serial - ${selectedProductForSerial?.name}`}\r\n        visible={serialModalVisible}\r\n        onCancel={() => setSerialModalVisible(false)}\r\n        footer={[\r\n          <Button key=\"cancel\" onClick={() => setSerialModalVisible(false)}>\r\n            Hủy\r\n          </Button>,\r\n          <Button key=\"add\" type=\"primary\" onClick={() => addSerialToCart(selectedSerials)} disabled={selectedSerials.length === 0}>\r\n            Thêm vào giỏ ({selectedSerials.length})\r\n          </Button>\r\n        ]}\r\n        width={800}\r\n      >\r\n        {availableSerials.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: '20px' }}>\r\n            <Text type=\"secondary\">Không có serial khả dụng cho sản phẩm này</Text>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            <div style={{ marginBottom: 16 }}>\r\n              <Text strong>Có {availableSerials.length} serial khả dụng</Text>\r\n            </div>\r\n            <List\r\n              dataSource={availableSerials}\r\n              renderItem={serial => (\r\n                <List.Item\r\n                  style={{\r\n                    cursor: 'pointer',\r\n                    backgroundColor: selectedSerials.find(s => s.id === serial.id) ? '#e6f7ff' : 'transparent',\r\n                    border: selectedSerials.find(s => s.id === serial.id) ? '1px solid #1890ff' : '1px solid #f0f0f0',\r\n                    marginBottom: 8,\r\n                    padding: 12,\r\n                    borderRadius: 4\r\n                  }}\r\n                  onClick={() => {\r\n                    const isSelected = selectedSerials.find(s => s.id === serial.id);\r\n                    if (isSelected) {\r\n                      setSelectedSerials(selectedSerials.filter(s => s.id !== serial.id));\r\n                    } else {\r\n                      setSelectedSerials([...selectedSerials, serial]);\r\n                    }\r\n                  }}\r\n                >\r\n                  <List.Item.Meta\r\n                    title={<Text code>{serial.serial_number}</Text>}\r\n                    description={\r\n                      <div>\r\n                        <Tag color=\"green\">{serial.status}</Tag>\r\n                        <Tag color=\"blue\">{serial.condition_grade}</Tag>\r\n                        {serial.location && <span>Vị trí: {serial.location}</span>}\r\n                      </div>\r\n                    }\r\n                  />\r\n                </List.Item>\r\n              )}\r\n            />\r\n          </div>\r\n        )}\r\n      </Modal>\r\n      <ToastContainer position=\"bottom-right\" autoClose={3000} hideProgressBar={false} newestOnTop={false} closeOnClick rtl={false} pauseOnFocusLoss draggable pauseOnHover />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default POSPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}